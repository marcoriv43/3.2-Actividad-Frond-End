(function(g){var window=this;'use strict';var Wnh=function(x){var T=new g.tv("und",new g.iQ("Default","und",!0));T.captionTracks=x.captionTracks;return T},DqP=function(x){return new g.lf(function(T,t){var u=x.length,H=[];
if(u)for(var I=function(l,m){u--;H[l]=m;u==0&&T(H)},E=function(l){t(l)},Z,e=0;e<x.length;e++)Z=x[e],g.fI4(Z,g.XD(I,e),E);
else T(H)})},nD=function(x){this.C=x},aq=function(){nD.apply(this,arguments)},y5C=function(){aq.apply(this,arguments)},NaV=function(){aq.apply(this,arguments)},J5V=function(){aq.apply(this,arguments)},C7b=function(){aq.apply(this,arguments)},QA0=function(){aq.apply(this,arguments)},pO9=function(){aq.apply(this,arguments)},Ok0=function(){nD.apply(this,arguments)},fMd=function(){aq.apply(this,arguments)},wOE=function(){aq.apply(this,arguments)},KnC=function(){aq.apply(this,arguments)},XOV=function(){aq.apply(this,
arguments)},x6h=function(){aq.apply(this,arguments)},Tw9=function(){aq.apply(this,arguments)},oLP=function(){aq.apply(this,arguments)},t3P=function(){aq.apply(this,arguments)},sCF=function(){aq.apply(this,arguments)},ui3=function(){aq.apply(this,arguments)},$6F=function(){aq.apply(this,arguments)},HsF=function(){aq.apply(this,arguments)},isE=function(){nD.apply(this,arguments)},IrV=function(){aq.apply(this,arguments)},ELF=function(){aq.apply(this,arguments)},qpP=function(){aq.apply(this,arguments)},
Zsy=function(){aq.apply(this,arguments)},jCF=function(){aq.apply(this,arguments)},ezh=function(){aq.apply(this,arguments)},lr9=function(){aq.apply(this,arguments)},m6h=function(){aq.apply(this,arguments)},d6y=function(){aq.apply(this,arguments)},M3b=function(){nD.apply(this,arguments)},AKy=function(){nD.apply(this,arguments)},Rzh=function(){nD.apply(this,arguments)},P6d=function(){aq.apply(this,arguments)},Sp3=function(){aq.apply(this,arguments)},cKb=function(){aq.apply(this,arguments)},Yph=function(){aq.apply(this,
arguments)},U6P=function(){aq.apply(this,arguments)},bsC=function(){aq.apply(this,arguments)},rKy=function(){aq.apply(this,arguments)},zzM=function(){aq.apply(this,arguments)},k2h=function(){aq.apply(this,arguments)},Flb=function(){aq.apply(this,arguments)},hz3=function(){aq.apply(this,arguments)},vLd=function(){aq.apply(this,arguments)},V33=function(){aq.apply(this,arguments)},G2d=function(){aq.apply(this,arguments)},Ll9=function(){aq.apply(this,arguments)},nLM=function(){aq.apply(this,arguments)},
arb=function(){aq.apply(this,arguments)},gLE=function(){aq.apply(this,arguments)},BwP=function(){aq.apply(this,arguments)},WlC=function(){aq.apply(this,arguments)},D6b=function(){aq.apply(this,arguments)},yKP=function(){aq.apply(this,arguments)},Nw3=function(){aq.apply(this,arguments)},JK3=function(){aq.apply(this,arguments)},C60=function(){aq.apply(this,arguments)},QC9=function(){aq.apply(this,arguments)},pL3=function(){nD.apply(this,arguments)},OsM=function(){aq.apply(this,arguments)},frP=function(){aq.apply(this,
arguments)},wL0=function(){aq.apply(this,arguments)},KlM=function(){aq.apply(this,arguments)},XLd=function(){aq.apply(this,arguments)},xj3=function(){aq.apply(this,arguments)},T7V=function(){aq.apply(this,arguments)},oaC=function(){aq.apply(this,arguments)},tCF=function(){aq.apply(this,arguments)},sFb=function(){aq.apply(this,arguments)},ur3=function(){aq.apply(this,arguments)},$jE=function(){aq.apply(this,arguments)},H$F=function(){aq.apply(this,arguments)},i$d=function(){aq.apply(this,arguments)},
IjM=function(){aq.apply(this,arguments)},EaC=function(){aq.apply(this,arguments)},qLh=function(){aq.apply(this,arguments)},Z$M=function(){aq.apply(this,arguments)},jFb=function(){aq.apply(this,arguments)},es3=function(){aq.apply(this,arguments)},ljF=function(){aq.apply(this,arguments)},mjC=function(){aq.apply(this,arguments)},djy=function(){aq.apply(this,arguments)},MCV=function(){aq.apply(this,arguments)},A80=function(){aq.apply(this,arguments)},Rsb=function(){aq.apply(this,arguments)},POC=function(){aq.apply(this,
arguments)},SL3=function(){aq.apply(this,arguments)},c8d=function(){aq.apply(this,arguments)},YL3=function(){aq.apply(this,arguments)},Ujh=function(x){x=x.key||x.id;
if(!x)throw Error("Entity key is missing");return x},b$P=function(){if(g1)return g1();
var x={};g1=g.X3("PersistentEntityStoreDb",{wG:(x.EntityStore={Fs:1},x.EntityAssociationStore={Fs:2},x),shared:!1,upgrade:function(T,t){t(1)&&g.GG(g.zG(T,"EntityStore",{keyPath:"key"}),"entityType","entityType");t(2)&&(T=g.zG(T,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.GG(T,"byParentEntityKey","parentEntityKey"),g.GG(T,"byChildEntityKey","childEntityKey"))},
version:3});return g1()},r8C=function(x){return g.yb(b$P(),x)},zsd=function(x){return g.yb((0,g.RtF)(),x)},B2=function(x){this.token=x},W2=function(x,T){T=T===void 0?{}:T;
g.CS.call(this,g.PVh[x],Object.assign({},{name:"PESEncoderError",type:x},T));this.type=x;this.level="WARNING";Object.setPrototypeOf(this,W2.prototype)},kub=function(x){return new W2("WRONG_DATA_TYPE",{gI:x})},F0b=function(x){return x instanceof Error?new W2("UNKNOWN_ENCODE_ERROR",{ud:x.message}):new W2("UNKNOWN_ENCODE_ERROR")},hsh=function(x){return x instanceof Error?new W2("UNKNOWN_DECODE_ERROR",{ud:x.message}):new W2("UNKNOWN_DECODE_ERROR")},va9=function(x,T){x=x instanceof W2?x:T(x);
g.vW(x);throw x;},VC9=function(){},GuE=function(x,T,t){try{return x.j(T,t)}catch(u){va9(u,F0b)}},L0M=function(x){x=(new TextEncoder).encode(x).subarray(0,16);
var T=new Uint8Array(16);T.set(x);return T},Da=function(x){this.C=x},ajb=function(x){var T=na3[x];
if(T)return T;g.Vh(new g.CS("Entity model not found.",{entityType:x}))},ga9=function(x,T){this.C=x;
this.Z=T;this.j={}},W0d=function(x,T){a:{x=B7V(x.Z,T.version);
try{var t=x.Z(T.data,T.key);break a}catch(u){va9(u,hsh)}t=void 0}return t},yH=function(x,T,t){return x.C.objectStore("EntityStore").get(T).then(function(u){if(u){if(t&&u.entityType!==t)throw Error("Incorrect entity type");
return W0d(x,u)}})},NZ=function(x,T,t){return t?(t=t.map(function(u){return yH(x,u,T)}),g.SD.all(t)):x.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(T)).then(function(u){return u.map(function(H){return W0d(x,H)})})},CD=function(x,T,t){var u=Ujh(T),H=B7V(x.Z,1),I=Object.assign({},T);
return x.C.objectStore("EntityStore").get(u).then(function(E){if(E){if(E.entityType!==t)throw Error("Incorrect entity type");I.entityMetadata||(E=W0d(x,E),I.entityMetadata=E.entityMetadata)}}).then(function(){var E={key:u,
entityType:t,data:GuE(H,I,u),version:1};return g.SD.all([g.hS(x.C.objectStore("EntityStore"),E),Dj9(x,I,t)])}).then(function(){Ji(x,u,t);
return u})},y8h=function(x,T,t){T=T.map(function(u){return CD(x,u,t)});
return g.SD.all(T)},QH=function(x,T,t){if(t==null?0:t.GG){var u=new Set;
return N7d(x,T,u).then(function(){for(var I=[],E=g.S(u),Z=E.next();!Z.done;Z=E.next())I.push(QH(x,Z.value));return g.SD.all(I).then(function(){})})}var H=g.u1(T).entityType;
return g.SD.all([x.C.objectStore("EntityStore").delete(T),J83(x,T)]).then(function(){Ji(x,T,H)})},CO3=function(x,T){return g.gm(x.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(T)},function(t){return g.SD.all([t.delete(),
J83(x,t.cursor.primaryKey)]).then(function(){Ji(x,t.cursor.primaryKey,T);return g.nM(t)})})},QFh=function(x,T,t,u){var H=B7V(x.Z,1);
return yH(x,T,u).then(function(I){if(I){I=g.lD(I,t);var E={key:T,entityType:u,data:GuE(H,I,T),version:1};return g.SD.all([g.hS(x.C.objectStore("EntityStore"),E),Dj9(x,I,u)])}}).then(function(){Ji(x,T,u);
return T})},Ji=function(x,T,t){var u=x.j[t];
u||(u=new Set,x.j[t]=u);u.add(T)},pD3=function(x,T,t){var u=Ujh(T);
t=ajb(t);if(!t)return g.SD.resolve([]);t=new t(T);x=x.C.objectStore("EntityAssociationStore");T=[];t=g.S(t.Z());for(var H=t.next();!H.done;H=t.next())T.push(g.hS(x,{parentEntityKey:u,childEntityKey:H.value}));return g.SD.all(T).then(function(I){return I.map(function(E){return E[1]})})},J83=function(x,T){return x.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(T))},Dj9=function(x,T,t){var u=Ujh(T);
return J83(x,u).then(function(){return pD3(x,T,t)})},N7d=function(x,T,t){if(t.has(T))return g.SD.resolve(void 0);
t.add(T);return O$9(x,T).then(function(u){return x.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(T)).then(function(){return u})}).then(function(u){var H=g.SD.resolve(void 0);
u=g.S(u);for(var I=u.next(),E={};!I.done;E={E5:void 0},I=u.next())E.E5=I.value,H=H.then(function(Z){return function(){return N7d(x,Z.E5,t)}}(E));
return H}).then(function(){})},O$9=function(x,T){var t=x.C.objectStore("EntityAssociationStore");
return t.index("byParentEntityKey").getAll(IDBKeyRange.only(T)).then(function(u){var H=[];u=g.S(u);for(var I=u.next();!I.done;I=u.next())I=I.value,H.push(t.index("byChildEntityKey").getAll(I.childEntityKey));return g.SD.all(H)}).then(function(u){var H=[];
u=g.S(u);for(var I=u.next();!I.done;I=u.next())I=I.value,I.length===1&&H.push(I[0].childEntityKey);return H})},pD=function(){},fjF=function(){this.C={};
this.C[0]=new pD;if(!g.R6("aes_pes_encoder_killswitch")){var x=this.C;try{var T=g.QT();var t=L0M(T);var u=new Da(new g.PC(t),new g.RO(t))}catch(H){throw x=H instanceof Error?new W2("KEY_CREATION_FAILED",{ud:H.message}):new W2("KEY_CREATION_FAILED"),g.vW(x),x;}x[1]=u}},B7V=function(x,T){T=T===void 0?0:T;
x=x.C[T];if(!x)throw T=new W2("INVALID_ENCODER_VERSION",{gI:T}),g.vW(T),T;return x},OG=function(x,T){g.W.call(this);
this.token=x;this.C=T;this.observers=[];x=new g.BX.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.QT());x.onmessage=this.Z.bind(this);this.channel=x},fD=function(x,T,t){var u,H,I,E;
return g.G(function(Z){if(Z.C==1)return g.v(Z,r8C(x.token),2);if(Z.C!=3)return u=Z.Z,g.v(Z,g.F3(u,["EntityStore","EntityAssociationStore"],T,function(e){H=new ga9(e,x.C);return t(H)}),3);
I=Z.Z;H&&(E=H.j,Object.keys(E).length>0&&(x.channel.postMessage(E),wD9(x,E)));return Z.return(I)})},w1=function(x,T,t){return fD(x,{mode:"readwrite",
c9:!0},function(u){return CD(u,T,t)})},K0y=function(x,T){return fD(x,{mode:"readwrite",
c9:!0},function(t){return y8h(t,T,"offlineOrchestrationActionWrapperEntity")})},XD9=function(x,T){return fD(x,{mode:"readwrite",
c9:!0},function(t){return QH(t,T)})},xn3=function(x){return fD(x,{mode:"readwrite",
c9:!0},function(T){return CO3(T,"videoPlaybackPositionEntity")})},KD=function(x,T,t){return fD(x,{mode:"readonly",
c9:!0},function(u){return yH(u,T,t)})},Xg=function(x,T,t){return fD(x,{mode:"readonly",
c9:!0},function(u){return NZ(u,T,t)})},wD9=function(x,T){x=g.S(x.observers);
for(var t=x.next();!t.done;t=x.next())t=t.value,t(T)},TlM=function(){var x,T,t;
return g.G(function(u){if(u.C==1)return g.PX(u,2),g.v(u,g.wm(),4);if(u.C!=2){x=u.Z;if(!x||!g.pS()||typeof g.BX.BroadcastChannel==="undefined")return u.return();T=new fjF;return u.return(new OG(x,T))}t=g.Yq(u);t instanceof Error&&g.vW(t);return u.return()})},xf=function(){o4d||(o4d=TlM());
return o4d},twb=function(x){var T;
x=(T=x.options)==null?void 0:T.persistenceOption;return x==="ENTITY_PERSISTENCE_OPTION_PERSIST"||x==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},s_9=function(x){var T;
return g.G(function(t){return t.C==1?g.v(t,xf(),2):(T=t.Z)?g.v(t,fD(T,"readwrite",function(u){for(var H={},I=g.S(x),E=I.next(),Z={};!E.done;Z={BD:void 0,C5:void 0},E=I.next())Z.BD=E.value,Z.BD.entityKey&&twb(Z.BD)&&(Z.C5=g.So(Z.BD.payload),E=void 0,Z.BD.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(E=function(e){return function(){return CD(u,e.BD.payload[e.C5],e.C5)}}(Z)),Z.BD.type==="ENTITY_MUTATION_TYPE_DELETE"&&(E=function(e){return function(){return QH(u,e.BD.entityKey)}}(Z)),Z.BD.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(E=function(e){return function(){return QFh(u,e.BD.entityKey,e.BD.payload[e.C5],e.C5)}}(Z)),E&&(H[Z.BD.entityKey]=H[Z.BD.entityKey]?H[Z.BD.entityKey].then(E):E()));
return g.SD.all(Object.values(H))}),0):t.return()})},uJy=function(x){var T;
return g.G(function(t){if(t.C==1){T=x.mutations;if(!T||T.length<=0)return t.return();if(g.TT){var u={type:"ENTITY_LOADED"};T!==void 0&&(u.payload=T);g.TT.dispatch(u)}return g.v(t,s_9(T),2)}T.length=0;g.RV(t)})},$nV=function(x){return x!==void 0},HE3=function(x){var T=g.z8();
T=Object.assign({},T);x=Object.assign({},x);for(var t in T)x[t]?(T[t]!==4&&(T[t]=x[t]),delete x[t]):T[t]!==2&&(T[t]=4);Object.assign(T,x);g.w13(T);JSON.stringify(T);return T},iEP=function(x){var T,t;
return g.G(function(u){if(u.C==1)return g.v(u,g.wm(),2);if(u.C!=3)return(T=u.Z)?g.v(u,g.hj(T),3):u.return();t=u.Z;return u.return(g.F3(t,["index","media","captions"],{mode:"readwrite",c9:!0},function(H){var I=IDBKeyRange.bound(x+"|",x+"~");H=[H.objectStore("index").delete(I),H.objectStore("media").delete(I),H.objectStore("captions").delete(I)];return g.SD.all(H).then(function(){})}))})},It9=function(){var x,T;
return g.G(function(t){if(t.C==1)return g.v(t,g.wm(),2);if(t.C!=3){x=t.Z;if(!x)throw g.Ru("rvdfd");return g.v(t,g.hj(x),3)}T=t.Z;return t.return(g.F3(T,["index","media"],{mode:"readwrite",c9:!0},function(u){var H={};return g.LM(u.objectStore("index"),{},function(I){var E=I.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),Z=g.SD.resolve(void 0);if(E){var e=E[1];E=E[2];H[e]=H[e]||{};var l;H[e][E]=g.oYv((l=I.getValue())==null?void 0:l.fmts)}else Z=I.delete().then(function(){});
return g.SD.all([g.nM(I),Z]).then(function(m){return g.S(m).next().value})}).then(function(){for(var I={},E=g.S(Object.keys(H)),Z=E.next();!Z.done;Z=E.next()){Z=Z.value;
var e=H[Z].v;I[Z]=H[Z].a&&e?1:2}var l=HE3(I);return g.F5f(u.objectStore("media"),{},function(m){var d=m.cursor.key.match(g.$Jf);d&&I[d[1]]||u.objectStore("media").delete(m.cursor.key);return g.PYm(m)}).then(function(){return l})})}))})},E4V=function(x,T){var t,u;
return g.G(function(H){if(H.C==1)return g.v(H,g.wm(),2);if(H.C!=3){t=H.Z;if(!t)throw g.Ru("wct");return g.v(H,g.hj(t),3)}u=H.Z;return g.v(H,g.F3(u,["captions"],{mode:"readwrite",c9:!0},function(I){var E=[];I=I.objectStore("captions");for(var Z=0;Z<T.length;Z++){var e=g.hS(I,T[Z],x+"|"+T[Z].metadata.vss_id);E.push(e)}return g.SD.all(E)}),0)})},q9d=function(x){var T,t,u;
return g.G(function(H){if(H.C==1)return T=IDBKeyRange.bound(x+"|",x+"~"),g.v(H,g.wm(),2);if(H.C!=3){t=H.Z;if(!t)throw g.Ru("gactfv");return g.v(H,g.hj(t),3)}u=H.Z;return H.return(u.getAll("captions",T))})},ZEd=function(x){return g.G(function(T){g.F4(x,0);
return T.return(iEP(x))})},j_0=function(x){return{context:g.O3(),
videoIds:x}},eNC=function(x){return{context:g.O3(),
playlistIds:x}},ltV=function(x){return{context:g.O3(),
offlinePlaylistSyncChecks:x}},mnF=function(){this.C=new Map},MwF=function(){dnd||(dnd=new mnF);
return dnd},A2y=function(x,T){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:x},metadata:T,statusCode:void 0,csn:void 0,can:void 0}},RNV=function(x,T,t){if(!t){var u=u===void 0?!1:u;
t=x.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!t||u)t=g.Sq(16),x.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",t)}x={flowNonce:t,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:T.eventType};T.metadata&&(x.flowMetadata=T.metadata);T.statusCode!==void 0&&(x.flowEventStatus=T.statusCode);T.csn&&(x.csn=T.csn);T.can&&(x.can=T.can);g.io("flowEvent",x,void 0)},P2C=function(x){var T,t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h;
return g.G(function(L){if(L.C==1)return g.v(L,fD(x,{mode:"readonly",c9:!0},function(a){return NZ(a,"playbackData").then(function(Ti){var u3=Ti.map(function(m3){return m3.transfer}).filter(function(m3){return!!m3}),$q=Ti.map(function(m3){return m3.offlineVideoPolicy}).filter(function(m3){return!!m3}),n=Ti.filter(function(m3){return!!m3.key}).map(function(m3){return g.$Q(g.u1(m3.key).entityId,"downloadStatusEntity")});
u3=NZ(a,"transfer",u3);$q=NZ(a,"offlineVideoPolicy",$q);n=NZ(a,"downloadStatusEntity",n);var qf=u3.then(function(m3){m3=m3.reduce(function(IV,hf){(hf==null?0:hf.offlineVideoStreams)&&IV.push.apply(IV,g.U(hf.offlineVideoStreams));return IV},[]).filter(function(IV){return!!IV});
return NZ(a,"offlineVideoStreams",m3)});
return g.SD.all([u3,$q,qf,n]).then(function(m3){var IV=g.S(m3);m3=IV.next().value;var hf=IV.next().value;var e0=IV.next().value;IV=IV.next().value;return[Ti,m3,hf,e0,IV]})})}),2);
if(L.C!=3)return T=L.Z,g.v(L,fD(x,{mode:"readonly",c9:!0},function(a){return NZ(a,"mainDownloadsListEntity").then(function(Ti){var u3,$q;return($q=(u3=Ti[0])==null?void 0:u3.downloads)!=null?$q:[]})}),3);
t=L.Z;u=g.S(T);H=u.next().value;I=u.next().value;E=u.next().value;Z=u.next().value;e=u.next().value;l=H;m=I;d=E;M=Z;A=e;R={};Y={};b={};z={};F={};V=[];B=g.S(m);for(D=B.next();!D.done;D=B.next())(f=D.value)&&(R[f.key]=f);O=g.S(d);for(sH=O.next();!sH.done;sH=O.next())(HX=sH.value)&&(Y[HX.key]=HX);xq=g.S(A);for(J=xq.next();!J.done;J=xq.next())(X=J.value)&&(b[X.key]=X);c=g.S(M);for(C=c.next();!C.done;C=c.next())(WX=C.value)&&(z[WX.key]=WX);PE=g.S(t);for(j0=PE.next();!j0.done;j0=PE.next())r5=j0.value,w5=
void 0,F[(w5=r5.videoItem)!=null?w5:""]=!0,r5.videoItem&&(md=tM=void 0,r=(md=(tM=g.u1(r5.videoItem))==null?void 0:tM.entityId)!=null?md:"",V.push({externalVideoId:r}));k=l.filter(function(a){if(!a||!a.key||!a.offlineVideoPolicy)return!1;a=g.u1(a.key).entityId;a=g.$Q(a,"downloadStatusEntity");var Ti;return!(a&&((Ti=b[a])==null?void 0:Ti.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
h=k.map(function(a){var Ti=R[a.transfer],u3=[];if(Ti==null?0:Ti.offlineVideoStreams)for(var $q=g.S(Ti.offlineVideoStreams),n=$q.next();!n.done;n=$q.next())(n=z[n.value])&&u3.push(n);$q=Y[a.offlineVideoPolicy];n=F;var qf=a==null?void 0:a.playerResponseTimestamp,m3=g.u1($q.key).entityId;a=g.$Q(m3,"mainVideoEntity");if($q.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var IV="OFFLINE_VIDEO_STATE_DISABLED";$q.expirationTimestamp&&Number($q.expirationTimestamp)<Date.now()/1E3&&(IV="OFFLINE_VIDEO_STATE_EXPIRED")}else if($q.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")IV="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Ti==null?void 0:Ti.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":IV="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":IV="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":IV="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":IV="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":IV="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":IV="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:IV="OFFLINE_VIDEO_STATE_UNKNOWN"}if(IV==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Ti==null?void 0:Ti.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":IV="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":IV="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":IV=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}m3={id:m3,videoState:IV};if(Ti==null?0:Ti.cotn)m3.cotn=Ti.cotn;if(Ti==null?0:Ti.maximumDownloadQuality)m3.selectedVideoQuality=Ti==null?void 0:Ti.maximumDownloadQuality;if(Ti==null?0:Ti.lastProgressTimeMs)m3.lastProgressTimeMs=Ti.lastProgressTimeMs;qf&&(m3.playerResponseSavedTimeMs=String(Number(qf)*1E3));Ti=String;qf=0;u3=g.S(u3);for(IV=u3.next();!IV.done;IV=u3.next())if(IV=IV.value,IV.streamsProgress){IV=g.S(IV.streamsProgress);for(var hf=IV.next();!hf.done;hf=
IV.next()){var e0=void 0;qf+=Number((e0=hf.value.numBytesDownloaded)!=null?e0:0)}}m3.downloadedBytes=Ti(qf);m3.selectedOfflineMode=n[a]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";$q.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(m3.offlinePlaybackDisabledReason=$q.offlinePlaybackDisabledReason);return m3});
return L.return({offlineVideos:h,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:V}}})})},S9V=function(){this.locks=navigator.locks},c20=function(){try{var x=g.yJ("ytglobal.locks_");
if(x)return x;var T;if(T=navigator){var t=navigator;T="locks"in t&&!!t.locks}if(T)return g.BX.localStorage&&g.BX.localStorage.getItem("noop"),x=new S9V,g.DC("ytglobal.locks_",x),x}catch(u){}},TR=function(){},Y9d=function(){},UnF=function(x){if(x.includes(":"))throw Error("Invalid user cache name: "+x);
return x+":"+g.QT("CacheStorage get")},bEd=function(){return g.G(function(x){if(oB!==void 0)return x.return(oB);
oB=new Promise(function(T){var t;return g.G(function(u){switch(u.C){case 1:return g.PX(u,2),g.v(u,tI.open("test-only"),4);case 4:return g.v(u,tI.delete("test-only"),5);case 5:g.cX(u,3);break;case 2:if(t=g.Yq(u),t instanceof Error&&t.name==="SecurityError")return T(!1),u.return();case 3:T("caches"in window),g.RV(u)}})});
return x.return(oB)})},zNV=function(){return g.G(function(x){if(x.C==1)return g.v(x,bEd(),2);
if(!x.Z)return x.return(void 0);r2b||(r2b=new Y9d);return x.return(r2b)})},sj=function(x,T,t){g.Vh(new g.CS("Woffle: "+x,t?{cotn:t}:""));
T instanceof Error&&g.Vh(T)},kd0=function(x){var T;
return g.G(function(t){if(t.C==1)return g.v(t,P2C(x),2);T=t.Z;g.io("offlineStateSnapshot",T);g.RV(t)})},up=function(x){g.W.call(this);
var T=this;this.api=x;this.yF={yJu:function(){return T.C},
wfc:function(){return T.Z}};
typeof g.BX.BroadcastChannel!=="undefined"&&(this.C=new g.BX.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.QT()),this.C.onmessage=this.j.bind(this),this.Z=new g.BX.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.QT()),this.Z.onmessage=this.K.bind(this))},$f=function(x,T){x.api.XW("onOfflineOperationFailure",T);
var t;(t=x.C)==null||t.postMessage(T)},FU3=function(x,T,t,u){var H=this;
this.J=x;this.S=T;this.visibility=t;this.B=u;this.T=this.N=this.D=this.j=this.C=!1;this.K=new g.wX(function(){H.WC()});
this.yF={AY:function(){return H.Z},
WC:function(){H.WC()},
ejm:function(){return H.K}};
this.visibility.subscribe("visibilitystatechange",function(){H.oH()})},hNC=function(x){if(!x.j&&!x.C){var T=c20();
if(T){x.j=!0;var t=g.QT("OfflineLockManager");T.request("woffle_orchestration_leader:"+t,{},function(){var u,H,I,E;return g.G(function(Z){switch(Z.C){case 1:return g.PX(Z,2),x.Z=new g.mn,x.C=!0,x.j=!1,g.v(Z,x.J(),4);case 4:return g.v(Z,x.Z.promise,5);case 5:g.cX(Z,0);break;case 2:u=g.Yq(Z),((I=(H=x).B)==null?0:I.call(H,"wo_relinquish_leadership_on_lock_request_error"))||x.WC(),u instanceof Error&&(E=u,E.args=[{name:"WoLockManagerError",yN:u.name}],g.vW(E)),g.RV(Z)}})})}}},v4b=function(x){x.C&&(x.T=
!0,HS(x))},Vwb=function(x,T){x.C&&(x.D=T,HS(x))},GdE=function(x,T){x.C&&(x.N=T,HS(x))},HS=function(x){x.N&&x.D&&x.T&&x.visibility.isBackground()?g.Kt(x.K,6E4):x.K.stop()},ip=function(x){var T;
x.offlineDeleteReason=(T=x.offlineDeleteReason)!=null?T:"OFFLINE_DELETE_REASON_UNKNOWN";var t;x.offlineModeType=(t=x.offlineModeType)!=null?t:"OFFLINE_NOW";g.io("offlineDeleteEvent",x)},IB=function(x,T){var t=T.videoId;
var u=T.ZN;T=T.offlineModeType;x.encryptedVideoId=t;x.cotn=u==null?void 0:u.cotn;x.offlineabilityFormatType=u==null?void 0:u.maximumDownloadQuality;var H;x.isRefresh=(H=u==null?void 0:u.isRefresh)!=null?H:!1;var I;x.softErrorCount=(I=u==null?void 0:u.transferRetryCount)!=null?I:0;x.offlineModeType=T!=null?T:"OFFLINE_NOW";(x.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&x.statusType==="UNKNOWN_STATUS_TYPE"||!x.transferStatusType&&!x.statusType)&&g.Vh(Error("Woffle unknown transfer status"));
g.io("offlineTransferStatusChanged",x)},LUy=function(x,T,t,u){u={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!u};T&&t&&(T=Math.floor(T/1024).toFixed(),t=Math.floor(t/1024).toFixed(),u.alreadyDownloadedKbytes=T,u.totalFetchedKbytes=T,u.totalContentKbytes=t);IB(u,x)},n4C=function(x){IB({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},x)},atC=function(x){switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Ej=function(x){var T,t,u;
return((u=(T=x.actionMetadata)==null?void 0:(t=T.retryScheduleIntervalsInSeconds)==null?void 0:t.length)!=null?u:0)>0},qh=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!x.entityKey},Zb=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!x.entityKey},j_=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!x.entityKey},g43=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!x.entityKey},
e_=function(x,T,t,u,H){H=H===void 0?!1:H;
var I,E,Z,e,l,m;return g.G(function(d){if(d.C==1)return I=g.$Q(x,T),E=g.$Q(x,"downloadStatusEntity"),g.v(d,fD(t,{mode:"readonly",c9:!0},function(M){return g.SD.all([yH(M,I,T),yH(M,E,"downloadStatusEntity")])}),2);
Z=d.Z;e=Z.length?Z[0]:void 0;if(!e)return d.lG(0);l=Bld;if(m=Z.length>1?Z[1]:void 0){if(m.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!H)return d.return();m.downloadState=u}else m={key:E,downloadState:u};g.gp(e,l,m);return g.v(d,fD(t,{mode:"readwrite",c9:!0},function(M){return g.SD.all([CD(M,e,T),CD(M,m,"downloadStatusEntity")])}),0)})},lp=function(x,T){return x.actionType===T.actionType&&x.entityKey===T.entityKey},m2=function(x,T){if(x&&x.transferState!=="TRANSFER_STATE_COMPLETE"&&x.transferState!==
"TRANSFER_STATE_FAILED"){var t=g.u1(x.key).entityId;
IB({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:t,ZN:x,offlineModeType:T})}},dA=function(x){if(!x||!x.thumbnails)return[];
var T=[];x=g.S(x.thumbnails);for(var t=x.next();!t.done;t=x.next())t=t.value,t.url&&T.push(t.url);return T},WUE=function(x,T,t){t=t===void 0?[]:t;
var u,H,I,E,Z,e,l,m,d,M,A,R,Y;return g.G(function(b){if(b.C==1)return t.length?g.v(b,Xg(x,T),2):b.return([]);u=b.Z;H=new Set;I=g.S(u);for(E=I.next();!E.done;E=I.next())if(Z=E.value,e=Z.id||Z.key)l=g.u1(e).entityId,H.add(l);m=[];d=g.S(t);for(M=d.next();!M.done;M=d.next())A=M.value,R=A.offlineVideoData,Y=void 0,((Y=R)==null?0:Y.videoId)&&!H.has(R.videoId)&&m.push(A);return b.return(m)})},Dnb=function(x,T,t){return new g.NE(x,{cotn:T,
raw_player_response:t,download_media:!0,start:Infinity,disable_watch_next:!0})},y2V=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Mh=function(x,T,t,u,H,I,E,Z,e,l,m){this.entityType=x;
this.actionId=T;this.action=t;this.parentActionId=u;this.rootActionId=H===void 0?T:H;this.childActionIds=I;this.prereqActionId=E;this.postreqActionIds=Z;this.hasChildActionFailed=l;this.retryScheduleIndex=0;this.C=m||Date.now();this.retryScheduleIndex=e||0},AI=function(x){if(!x.key)throw Error("Entity key is required.");
if(!x.actionProto)throw Error("OfflineOrchestrationAction is required.");var T=g.u1(x.key),t=g.u1(x.actionProto.entityKey);return new Mh(t.entityType,T.entityId,x.actionProto,x.parentActionId,x.rootActionId,x.childActionIds,x.prereqActionId,x.postreqActionIds,x.retryScheduleIndex,x.hasChildActionFailed,Number(x.enqueueTimeSec)*1E3)},RB=function(x){return{key:g.$Q(x.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:x.action,parentActionId:x.parentActionId,rootActionId:x.rootActionId,childActionIds:x.childActionIds,prereqActionId:x.prereqActionId,postreqActionIds:x.postreqActionIds,retryScheduleIndex:x.retryScheduleIndex,hasChildActionFailed:x.hasChildActionFailed,enqueueTimeSec:(x.C/1E3).toFixed()}},NlF=function(){var x;
return g.G(function(T){return T.C==1?g.v(T,zNV(),2):(x=T.Z)?T.return(x.delete("yt-player-local-img")):T.return(!0)})},PS=function(x){var T,t;
return g.G(function(u){if(u.C==1)return g.v(u,zNV(),2);if(u.C!=3){T=u.Z;if(!T)throw Error("Cache API not supported");return x.length?g.v(u,T.open("yt-player-local-img"),3):u.return()}t=u.Z;return g.v(u,Promise.all(x.map(function(H){return t.delete(H)})),0)})},S_=function(x){var T,t;
return g.G(function(u){if(u.C==1)return g.v(u,zNV(),2);if(u.C!=3){T=u.Z;if(!T)throw Error("Cache API not supported");return x.length?g.v(u,T.open("yt-player-local-img"),3):u.return()}t=u.Z;return g.v(u,t.addAll(x),0)})},cS=function(x,T,t,u,H){var I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5;
return g.G(function(tM){switch(tM.C){case 1:return I=g.$Q(x,"mainVideoEntity"),E=g.$Q(x,"ytMainChannelEntity"),Z=g.$Q(x,"transfer"),e=g.$Q(x,"videoDownloadContextEntity"),g.v(tM,fD(T,{mode:"readonly",c9:!0},function(md){return g.SD.all([yH(md,I,"mainVideoEntity"),yH(md,E,"ytMainChannelEntity"),yH(md,Z,"transfer"),yH(md,e,"videoDownloadContextEntity"),NZ(md,"ytMainChannelEntity"),NZ(md,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=tM.Z;m=g.S(l);d=m.next().value;M=m.next().value;A=m.next().value;R=m.next().value;Y=m.next().value;b=m.next().value;z=d;F=M;V=A;B=R;D=Y;f=b;if(!z&&!F){tM.lG(3);break}O=z?dA(z.thumbnail):[];if(!F){sH=[];tM.lG(4);break}return g.v(tM,J2h(F,D),5);case 5:sH=tM.Z;case 4:return HX=sH,g.v(tM,PS(O.concat(HX)),3);case 3:xq=[];J=g.$Q(x,"downloadStatusEntity");X=g.S(f);for(c=X.next();!c.done;c=X.next())C=c.value,WX=g.u1(C.key).entityId,PE=AI(C),j0=g.u1(PE.action.entityKey).entityId,WX!==x&&j0!==x||lp(t,
C.actionProto)||xq.push(C.key);return g.v(tM,fD(T,{mode:"readwrite",c9:!0},function(md){var r=xq.map(function(k){return QH(md,k)});
r.push(QH(md,I,{GG:!0}));r.push(QH(md,J,{GG:!0}));return g.SD.all(r)}),7);
case 7:w5=(r5=B)==null?void 0:r5.offlineModeType,H&&(ip(H),H.offlineModeType&&(w5=H.offlineModeType)),m2(V,w5),$f(u,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.RV(tM)}})},pfP=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h,L,a,Ti,u3,$q,n,qf,m3,IV,hf,e0,gy,jQ;
return g.G(function(Jf){switch(Jf.C){case 1:return H=g.$Q(x,"mainPlaylistEntity"),I=g.$Q(x,"ytMainChannelEntity"),g.v(Jf,fD(T,{mode:"readonly",c9:!0},function(BI){return g.SD.all([yH(BI,H,"mainPlaylistEntity"),yH(BI,I,"ytMainChannelEntity"),NZ(BI,"mainPlaylistEntity"),NZ(BI,"mainDownloadsListEntity"),NZ(BI,"ytMainChannelEntity"),NZ(BI,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Jf.Z;Z=g.S(E);e=Z.next().value;l=Z.next().value;m=Z.next().value;d=Z.next().value;M=Z.next().value;A=Z.next().value;R=e;Y=l;b=m;z=d;F=M;V=A;if(!R&&!Y){Jf.lG(3);break}B=R?C2d(R):[];if(!Y){D=[];Jf.lG(4);break}return g.v(Jf,J2h(Y,F),5);case 5:D=Jf.Z;case 4:return f=D,g.v(Jf,PS(B.concat(f)),3);case 3:O=[];sH=new Map;if(!R){Jf.lG(7);break}return g.v(Jf,Q_d(R,b,z),8);case 8:O=Jf.Z;HX=g.S(O);for(xq=HX.next();!xq.done;xq=HX.next())J=xq.value,sH.set(J,{videoId:J,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.v(Jf,fD(T,{mode:"readonly",c9:!0},function(BI){return g.SD.all([NZ(BI,"transfer"),NZ(BI,"videoDownloadContextEntity")])}),9);
case 9:X=Jf.Z;c=g.S(X);C=c.next().value;WX=c.next().value;PE=C;j0=WX;r5=g.S(PE);for(w5=r5.next();!w5.done;w5=r5.next())tM=w5.value,md=g.u1(tM.key).entityId,(r=sH.get(md))&&tM&&(r.cotn=tM.cotn);k=g.S(j0);for(h=k.next();!h.done;h=k.next())L=h.value,a=g.u1(L.key).entityId,(Ti=sH.get(a))&&L&&(Ti.offlineModeType=L.offlineModeType);case 7:u3=[];$q=g.S(V);for(n=$q.next();!n.done;n=$q.next())qf=n.value,m3=g.u1(qf.key).entityId,IV=AI(qf),m3!==x&&IV.rootActionId!==x||lp(t,qf.actionProto)||u3.push(qf.key);hf=
g.$Q(x,"mainPlaylistEntity");return g.v(Jf,fD(T,{mode:"readwrite",c9:!0},function(BI){var Ig=u3.map(function(hC){return QH(BI,hC)});
Ig.push(QH(BI,hf,{GG:!0}));return g.SD.all(Ig)}),10);
case 10:if(!R){Jf.lG(0);break}O.reverse();if(!O){Jf.lG(0);break}e0=g.S(O);gy=e0.next();case 13:if(gy.done){Jf.lG(0);break}jQ=gy.value;return g.v(Jf,cS(jQ,T,t,u,sH.get(jQ)),14);case 14:gy=e0.next(),Jf.lG(13)}})},ftE=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M;
return g.G(function(A){if(A.C==1)return H=g.$Q("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),I=new Map,g.v(A,fD(x,{mode:"readwrite",c9:!0},function(R){var Y=NZ(R,"transfer"),b=NZ(R,"offlineOrchestrationActionWrapperEntity"),z=NZ(R,"videoDownloadContextEntity"),F=yH(R,H,"mainDownloadsListEntity");return g.SD.all([Y,b,z,F]).then(function(V){V=g.S(V);var B=V.next().value;var D=V.next().value;var f=V.next().value;var O=V.next().value;V=OEy.map(function(HX){return CO3(R,HX)});
D=g.S(D);for(var sH=D.next();!sH.done;sH=D.next())sH=sH.value,lp(T,sH.actionProto)||V.push(QH(R,sH.key,{GG:!0}));O&&(O.downloads=[],V.push(CD(R,O,"mainDownloadsListEntity")));if(f)for(f=g.S(f),O=f.next();!O.done;O=f.next())O=O.value,D=g.u1(O.key).entityId,D=g.$Q(D,"transfer"),I.set(D,O.offlineModeType);return g.SD.all(V).then(function(){return B})})}),2);
E=A.Z;Z=g.S(E);for(e=Z.next();!e.done;e=Z.next())l=e.value,m2(l,I.get(l.key)),m=g.u1(l.key).entityId,d={videoId:m,offlineDeleteReason:u,cotn:l.cotn,offlineModeType:I.get(l.key)},ip(d),M=g.$Q(m,"mainVideoEntity"),$f(t,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(A,NlF(),0)})},C2d=function(x,T){var t=[];
if(x.thumbnailStyleData){x=g.S(x.thumbnailStyleData);for(var u=x.next();!u.done;u=x.next()){var H=void 0,I=void 0,E=void 0;t=t.concat(dA((H=u.value)==null?void 0:(I=H.value)==null?void 0:(E=I.collageThumbnail)==null?void 0:E.coverThumbnail))}}T=dA(T);return t.concat(T)},Q_d=function(x,T,t){var u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX;
return g.G(function(xq){u=[];H=new Set;if(t.length)for(I=g.S(t),E=I.next();!E.done;E=I.next())if(Z=E.value,e=void 0,(e=Z.downloads)==null?0:e.length)for(l=g.S(Z.downloads),m=l.next();!m.done;m=l.next())d=m.value,d.videoItem&&(M=g.u1(d.videoItem).entityId,H.add(M));if(x.videos){A=g.S(x.videos);for(R=A.next();!R.done;R=A.next())Y=R.value,b=JSON.parse(g.u1(Y).entityId),b.videoId&&!H.has(b.videoId)&&u.push(b.videoId);z=g.S(T);for(F=z.next();!F.done;F=z.next())if(V=F.value,V.key!==x.key&&(B=V.videos))for(D=
g.S(B),f=D.next();!f.done;f=D.next())O=f.value,sH=JSON.parse(g.u1(O).entityId),sH.videoId&&(HX=u.indexOf(sH.videoId),HX!==-1&&u.splice(HX,1))}return xq.return(u)})},J2h=function(x,T){var t,u,H,I,E,Z,e,l;
return g.G(function(m){t=dA(x.avatar);u=g.S(T);for(H=u.next();!H.done;H=u.next())if(I=H.value,I.id!==x.id)for(E=g.S(dA(I.avatar)),Z=E.next();!Z.done;Z=E.next())e=Z.value,l=t.indexOf(e),l!==-1&&t.splice(l,1);return m.return(t)})},wf9=function(x){var T;
return g.G(function(t){T=g.N(x.frameworkUpdates,Yf);return x.frameworkUpdates&&T?g.v(t,uJy(T),0):t.return()})},Xfd=function(x){var T;
if((T=x.onResponseReceivedActions)!=null&&T.length){var t;x=(t=g.N(g.N(x.onResponseReceivedActions[0],KUP),g.mv3))==null?void 0:t.actions;if(x!=null&&x.length)return x}},xzy=function(x){var T,t,u;
return g.G(function(H){if(H.C==1)return x?g.v(H,KD(x,g.Lp,"mainDownloadsListEntity"),2):H.return([]);T=H.Z;return((t=T)==null?0:(u=t.downloads)==null?0:u.length)?H.return(T.downloads.map(function(I){var E;return(E=I.videoItem)!=null?E:""})):H.return([])})},oJ0=function(x,T){var t;
return g.G(function(u){return u.C==1?g.v(u,TTy(x,T),2):(t=u.Z)?g.v(u,fD(x,{mode:"readwrite",c9:!0},function(H){var I=[CD(H,t.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];t.mainDownloadsListEntity&&I.push(CD(H,t.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.SD.all(I)}),0):u.lG(0)})},TTy=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V;
return g.G(function(B){if(B.C==1)return t=g.$Q("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.$Q("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(B,fD(x,{mode:"readonly",c9:!0},function(D){return g.SD.all([yH(D,t,"mainDownloadsLibraryEntity"),yH(D,u,"mainDownloadsListEntity")])}),2);
H=B.Z;I=g.S(H);E=I.next().value;Z=I.next().value;e=E;l=Z;e||(e={id:t});m=g.S(T);for(d=m.next();!d.done;d=m.next())if(M=d.value,M===g.Lp){if(e.smartDownloadsList)return B.return();e.smartDownloadsList=M}else if(A=g.u1(M).entityType,R={},A==="mainPlaylistEntity"?R.playlistItem=M:A==="mainVideoEntity"&&(R.videoItem=M),!g.z0(R)){Y=void 0;if((Y=l)==null?0:Y.downloads){b=!1;z=g.S(l.downloads);for(F=z.next();!F.done;F=z.next())if(V=F.value,V.playlistItem===M||V.videoItem===M){b=!0;break}b||l.downloads.push(R)}else l=
{id:u,downloads:[R]};e.downloadsList=u}return B.return({mainDownloadsLibraryEntity:e,mainDownloadsListEntity:l})})},t59=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b;
return g.G(function(z){if(z.C==1)return t=g.$Q("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.$Q("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(z,fD(x,{mode:"readonly",c9:!0},function(F){return g.SD.all([yH(F,t,"mainDownloadsLibraryEntity"),yH(F,u,"mainDownloadsListEntity"),yH(F,g.Lp,"mainDownloadsListEntity")])}),2);
H=z.Z;I=g.S(H);E=I.next().value;Z=I.next().value;e=I.next().value;l=E;m=Z;d=e;if(!l)return z.lG(0);if(T===g.Lp&&((M=d)==null?0:M.downloads))d.downloads=[];else if((A=m)==null?0:A.downloads)for(R=g.u1(T).entityType,Y=0;Y<m.downloads.length;Y++)if(b=m.downloads[Y],R==="mainVideoEntity"&&b.videoItem===T){m.downloads.splice(Y,1);break}else if(R==="mainPlaylistEntity"&&b.playlistItem===T){m.downloads.splice(Y,1);break}return g.v(z,fD(x,{mode:"readwrite",c9:!0},function(F){var V=[CD(F,l,"mainDownloadsLibraryEntity")];
m&&V.push(CD(F,m,"mainDownloadsListEntity"));d&&V.push(CD(F,d,"mainDownloadsListEntity"));return g.SD.all(V)}),0)})},Uj=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M;
return g.G(function(A){if(A.C==1)return t=g.$Q(T,"transfer"),u=g.$Q(T,"videoDownloadContextEntity"),g.v(A,fD(x,{mode:"readonly",c9:!0},function(R){return g.SD.all([yH(R,t,"transfer"),yH(R,u,"videoDownloadContextEntity")])}),2);
H=A.Z;I=g.S(H);E=I.next().value;Z=I.next().value;e=E;l=Z;M={videoId:T,cotn:(m=e)==null?void 0:m.cotn,offlineModeType:(d=l)==null?void 0:d.offlineModeType};return A.return(M)})},bp=function(x,T,t,u,H){var I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH;
return g.G(function(HX){switch(HX.C){case 1:return I=g.$Q(x,"musicTrack"),E=g.$Q(x,"transfer"),g.v(HX,fD(T,{mode:"readonly",c9:!0},function(xq){return g.SD.all([yH(xq,I,"musicTrack"),yH(xq,E,"transfer"),NZ(xq,"musicTrack"),NZ(xq,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=HX.Z;e=g.S(Z);l=e.next().value;m=e.next().value;d=e.next().value;M=e.next().value;A=l;R=m;Y=d;b=M;if(!A){HX.lG(3);break}return g.v(HX,smb(A,Y),4);case 4:return z=HX.Z,g.v(HX,PS(z),3);case 3:F=[];V=g.S(b);for(B=V.next();!B.done;B=V.next())D=B.value,f=g.u1(D.key).entityId,O=AI(D),sH=g.u1(O.action.entityKey).entityId,f!==x&&sH!==x||lp(t,D.actionProto)||F.push(D.key);return g.v(HX,fD(T,{mode:"readwrite",c9:!0},function(xq){var J=F.map(function(X){return QH(xq,X)});
J.push(QH(xq,I,{GG:!0}));return g.SD.all(J)}),6);
case 6:m2(R),H&&ip(H),$f(u,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.RV(HX)}})},rA=function(x,T,t,u,H){var I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h;
return g.G(function(L){switch(L.C){case 1:return I=g.$Q(x,T),E=g.$Q("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(L,fD(t,{mode:"readonly",c9:!0},function(a){return g.SD.all([yH(a,I,T),yH(a,E,"musicDownloadsLibraryEntity"),NZ(a,T),NZ(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=L.Z;e=g.S(Z);l=e.next().value;m=e.next().value;d=e.next().value;M=e.next().value;A=l;R=m;Y=d;b=M;if(!A){L.lG(3);break}return g.v(L,smb(A,Y),4);case 4:return z=L.Z,g.v(L,PS(z),3);case 3:F=[];V=new Map;if(!A){L.lG(6);break}return g.v(L,uPy(A,Y,R),7);case 7:F=L.Z;B=g.S(F);for(D=B.next();!D.done;D=B.next())f=D.value,O=g.u1(f).entityId,V.set(O,{videoId:O,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.v(L,Xg(t,"transfer"),8);case 8:for(sH=L.Z,HX=g.S(sH),
xq=HX.next();!xq.done;xq=HX.next())J=xq.value,X=g.u1(J.key).entityId,(c=V.get(X))&&J&&(c.cotn=J.cotn);case 6:C=[];WX=g.S(b);for(PE=WX.next();!PE.done;PE=WX.next())j0=PE.value,r5=g.u1(j0.key).entityId,w5=AI(j0),r5!==x&&w5.rootActionId!==x||lp(u,j0.actionProto)||C.push(j0.key);tM=g.$Q(x,T);return g.v(L,fD(t,{mode:"readwrite",c9:!0},function(a){var Ti=C.map(function(u3){return QH(a,u3)});
Ti.push(QH(a,tM,{GG:!0}));return g.SD.all(Ti)}),9);
case 9:if(!A){L.lG(0);break}F.reverse();if(!F.length){L.lG(0);break}md=g.S(F);r=md.next();case 12:if(r.done){L.lG(0);break}k=r.value;h=g.u1(k).entityId;if(!h){L.lG(13);break}return g.v(L,bp(h,t,u,H,V.get(h)),13);case 13:r=md.next(),L.lG(12)}})},zR=function(x,T,t){var u,H,I,E,Z,e,l;
return g.G(function(m){if(m.C==1)return g.v(m,fD(x,{mode:"readwrite",c9:!0},function(d){var M=NZ(d,"transfer"),A=NZ(d,"offlineOrchestrationActionWrapperEntity");return g.SD.all([M,A]).then(function(R){R=g.S(R);var Y=R.next().value;var b=R.next().value;R=$z9.map(function(B){return CO3(d,B)});
b=g.S(b);for(var z=b.next();!z.done;z=b.next()){z=z.value;var F=g.u1(z.actionProto.entityKey).entityType==="musicTrack",V=z.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";lp(T,z.actionProto)||F&&(!F||V)||R.push(QH(d,z.key,{GG:!0}))}return g.SD.all(R).then(function(){return Y})})}),2);
u=m.Z;H=g.S(u);for(I=H.next();!I.done;I=H.next())E=I.value,m2(E),Z=g.u1(E.key).entityId,e={videoId:Z,offlineDeleteReason:void 0,cotn:E.cotn},ip(e),l=g.$Q(Z,"musicTrack"),$f(t,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(m,NlF(),0)})},H5b=function(x){for(var T,t=g.S(x.additionalMetadatas),u=t.next();!u.done;u=t.next())u=u.value,u.offlineMusicVideoData&&(T=u.offlineMusicVideoData);
var H,I,E,Z,e;return{id:g.$Q(x.videoId,"musicTrack"),videoId:x.videoId,title:x.title,thumbnailDetails:x.thumbnail,lengthMs:String(Number(x.lengthSeconds)*1E3),albumTitle:(H=T)==null?void 0:H.releaseTitle,musicVideoType:(I=T)==null?void 0:I.musicVideoType,contentRating:{explicitType:(E=T)==null?void 0:E.explicitType},artistNames:((Z=T)==null?void 0:Z.byline)||((e=T)==null?void 0:e.channelName),downloadMetadata:g.$Q(x.videoId,"musicTrackDownloadMetadataEntity")}},uPy=function(x,T,t){var u,H,I,E,Z,e,
l,m,d,M,A,R,Y,b,z,F,V,B;
return g.G(function(D){u=[];H=new Set;if((I=t)==null?0:(E=I.downloadedTracks)==null?0:E.length)for(Z=g.S(t.downloadedTracks),e=Z.next();!e.done;e=Z.next())l=e.value,H.add(l);if(x.tracks){m=g.S(x.tracks);for(d=m.next();!d.done;d=m.next())M=d.value,H.has(M)||u.push(M);A=g.S(T);for(R=A.next();!R.done;R=A.next())if(Y=R.value,Y.id!==x.id&&(b=Y.tracks))for(z=g.S(b),F=z.next();!F.done;F=z.next())V=F.value,B=u.indexOf(V),B!==-1&&u.splice(B,1)}return D.return(u)})},smb=function(x,T){var t,u,H,I,E,Z,e,l;
return g.G(function(m){t=dA(x.thumbnailDetails);u=g.S(T);for(H=u.next();!H.done;H=u.next())if(I=H.value,I.id!==x.id)for(E=g.S(dA(I.thumbnailDetails)),Z=E.next();!Z.done;Z=E.next())e=Z.value,l=t.indexOf(e),l!==-1&&t.splice(l,1);return m.return(t)})},i5F=function(x,T){var t,u,H,I,E,Z,e,l,m;
return g.G(function(d){if(d.C==1)return t=g.$Q("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(d,KD(x,t,"musicDownloadsLibraryEntity"),2);(u=d.Z)||(u={id:t});H=g.u1(T).entityType;H==="musicTrack"?(I=u.downloadedTracks)!=null&&I.includes(T)||(u.downloadedTracks=((E=u.downloadedTracks)!=null?E:[]).concat(T)):H==="musicPlaylist"?(Z=u.downloadedPlaylists)!=null&&Z.includes(T)||(u.downloadedPlaylists=((e=u.downloadedPlaylists)!=null?e:[]).concat(T)):H!=="musicAlbumRelease"||(l=u.downloadedAlbumReleases)!=
null&&l.includes(T)||(u.downloadedAlbumReleases=((m=u.downloadedAlbumReleases)!=null?m:[]).concat(T));return g.v(d,w1(x,u,"musicDownloadsLibraryEntity"),0)})},IK9=function(x,T){var t,u,H,I,E,Z,e;
return g.G(function(l){if(l.C==1)return t=g.$Q("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(l,KD(x,t,"musicDownloadsLibraryEntity"),2);u=l.Z;if(!u)return l.lG(0);H=g.u1(T).entityType;H==="musicTrack"?I=u.downloadedTracks:H==="musicPlaylist"&&(I=u.downloadedPlaylists);if((E=I)==null?0:E.length)for(Z=0;Z<I.length;Z++)if(e=I[Z],e===T){I.splice(Z,1);break}return g.v(l,w1(x,u,"musicDownloadsLibraryEntity"),0)})},EJb=function(x){var T=x.videos;
x=[];var t=[];if(T){T=g.S(T);for(var u=T.next();!u.done;u=T.next()){var H=u.value.offlineVideoData.videoId;u=g.$Q(H,"musicTrack");H=g.$Q(H,"musicTrackDownloadMetadataEntity");x.push(u);t.push(H)}}return{CL:x,bE:t}},kf=function(x,T,t){T={track:H5b(T)};
t&&(T.playlistId=t);if(x=g.N(x.actionMetadata,qSh))T.maximumDownloadQuality=x.maximumDownloadQuality;return{musicTrackEntityActionMetadata:T}},jmF=function(x){var T,t,u,H,I,E,Z,e;
return g.G(function(l){switch(l.C){case 1:return T=g.s6(),t=j_0(x),u=g.K2(Z5P),g.PX(l,2),I={oY:!0},g.v(l,g.QK(T,t,u,void 0,I),4);case 4:H=l.Z;g.cX(l,3);break;case 2:E=g.Yq(l);if(E instanceof g.Nk)throw Z="GetOffline network manager error: "+E.message,sj(Z,E),Error(Z);sj("GetOffline fetch request error",E);throw Error("GetOffline fetch request error");case 3:e=F5(H);if(!H)throw sj("Network request failed"),Error("Network request failed");if(e!==void 0)hI(e);else if(!H.videos||!H.videos.length)throw sj("No data"),
Error("No data");return l.return(H.videos.map(function(m){return m.offlineVideoData}))}})},eIC=function(x){var T,t,u,H,I,E,Z,e;
return g.G(function(l){switch(l.C){case 1:return T=g.s6(),t=eNC(x),u=g.K2(Z5P),g.PX(l,2),I={oY:!0},g.v(l,g.QK(T,t,u,void 0,I),4);case 4:H=l.Z;g.cX(l,3);break;case 2:E=g.Yq(l);if(E instanceof g.Nk)throw Z="GetOffline network manager error for playlist: "+E.message,sj(Z,E),Error(Z);sj("GetOffline fetch request error for playlist",E);throw Error("GetOffline fetch request error for playlist");case 3:e=F5(H);if(!H)throw sj("Network request failed for playlist"),Error("Network request failed for playlist");
if(e!==void 0)hI(e,"playlist");else if(!H.playlists||!H.playlists.length)throw sj("No data for playlist"),Error("No data for playlist");return l.return(H.playlists.map(function(m){return m.offlinePlaylistData}))}})},mzV=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0;
return g.G(function(r5){switch(r5.C){case 1:return g.v(r5,xf(),2);case 2:H=r5.Z;if(!H)return r5.return([]);I=[];if((E=u)==null?0:E.length){I=u;r5.lG(3);break}return g.v(r5,Xg(H,"mainPlaylistEntity"),4);case 4:I=r5.Z;case 3:if(!I.length)return r5.return([]);Z=[];e=Date.now()/1E3;l=g.S(I);m=l.next();case 5:if(m.done)return Z.length?g.v(r5,lKy(Z),10):r5.return([]);d=m.value;if(!d.downloadState){M=void 0;r5.lG(8);break}return g.v(r5,KD(H,d.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:M=
r5.Z;case 8:A=M;R=void 0;b=(Y=(R=d)==null?void 0:R.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;z=Number.isNaN(b)?x:b;V=F=void 0;B=((F=A)==null?0:F.lastSyncedTimestampMillis)?Number((V=A)==null?void 0:V.lastSyncedTimestampMillis)/1E3:0;f=D=void 0;O=((D=A)==null?0:D.addedTimestampMillis)?Number((f=A)==null?void 0:f.addedTimestampMillis)/1E3:0;if(t||!Y||B+z<=e){sH=[];HX=void 0;if((HX=d.videos)==null?0:HX.length)for(xq=g.S(d.videos),J=xq.next();!J.done;J=
xq.next())X=J.value,c=JSON.parse(g.u1(X).entityId),c.videoId&&sH.push(c.videoId);C="0";Y&&(WX=void 0,C=String(Number((WX=Y.offlineLastModifiedTimestampSeconds)!=null?WX:0).toFixed()));PE={playlistId:d.playlistId,videoIds:sH,offlineLastModifiedTimestamp:C,autoSync:T,offlineDateAddedTimestamp:String(O.toFixed())};Z.push(PE)}m=l.next();r5.lG(5);break;case 10:return j0=r5.Z,r5.return(j0)}})},dzM=function(){var x,T,t,u,H;
return g.G(function(I){if(I.C==1)return g.v(I,xf(),2);if(I.C!=3)return(x=I.Z)?g.v(I,Xg(x,"refresh"),3):I.return(!1);T=I.Z;if((t=T[0])==null||!t.refreshTime)return I.return(!1);u=Number(T[0].refreshTime);H=Date.now()/1E3;return I.return(isFinite(u)&&H>=u)})},Ap3=function(x,T){var t,u,H;
return g.G(function(I){switch(I.C){case 1:return g.PX(I,2),g.v(I,M59(x,T),4);case 4:return u=I.Z,g.v(I,wf9(u),5);case 5:t=Xfd(u);g.cX(I,3);break;case 2:H=g.Yq(I),sj("getAndProcessSmartDownloadsResponse request or processing error",H);case 3:return I.return(t)}})},RIb=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0;
return g.G(function(r5){switch(r5.C){case 1:return g.v(r5,xf(),2);case 2:H=r5.Z;if(!H)return r5.return([]);I=[];if((E=u)==null?0:E.length){I=u;r5.lG(3);break}return g.v(r5,Xg(H,"musicPlaylist"),4);case 4:I=r5.Z;case 3:if(!I.length)return r5.return([]);Z=[];e=Date.now()/1E3;l=g.S(I);m=l.next();case 5:if(m.done)return Z.length?g.v(r5,lKy(Z),10):r5.return([]);d=m.value;M=void 0;R=(A=(M=d)==null?void 0:M.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;Y=
Number.isNaN(R)?x:R;z=b=0;F="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!d.downloadMetadata){r5.lG(8);break}return g.v(r5,KD(H,d.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:V=r5.Z,D=B=void 0,b=Number((D=(B=V)==null?void 0:B.addedTimestampMillis)!=null?D:"0")/1E3,O=f=void 0,z=Number((O=(f=V)==null?void 0:f.lastModifiedTimestampMillis)!=null?O:"0")/1E3,HX=sH=void 0,F=(HX=(sH=V)==null?void 0:sH.syncState)!=null?HX:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:xq=void 0;if(t||F!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!A||Number((xq=A.lastSyncedTimestampSeconds)!=null?xq:0)+Y<=e){J=[];X=void 0;if((X=d.tracks)==null?0:X.length)for(c=g.S(d.tracks),C=c.next();!C.done;C=c.next())WX=C.value,J.push(g.u1(WX).entityId);PE={playlistId:d.playlistId,videoIds:J,offlineLastModifiedTimestamp:String(z.toFixed()),autoSync:T,offlineDateAddedTimestamp:String(b.toFixed())};Z.push(PE)}m=l.next();r5.lG(5);break;case 10:return j0=r5.Z,r5.return(j0)}})},M59=function(x,T){var t,u,H,I,E,Z,e,l,m,d;
return g.G(function(M){switch(M.C){case 1:return t=g.s6(),g.v(M,xf(),2);case 2:u=M.Z;if(!u){M.lG(3);break}return g.v(M,P2C(u),4);case 4:H=M.Z;case 3:var A=H;I={context:g.O3(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:x},offlineClientState:A,clientStateRequestData:{preferredFormatType:T}}}};E=g.K2(PIP);g.PX(M,5);e={oY:!0};return g.v(M,g.QK(t,I,E,void 0,e),7);case 7:Z=M.Z;g.cX(M,6);break;case 5:l=g.Yq(M);if(l instanceof g.Nk)throw m=
"DPS network manager error for smart downloads: "+l.message,sj(m,l),Error(m);sj("DPS fetch request error for smart downloads",l);throw Error("DPS fetch request error for smart downloads");case 6:d=F5(Z);if(Z)d!==void 0&&hI(d,"smart downloads");else throw sj("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return M.return(Z)}})},cpC=function(x,T){var t,u,H,I,E,Z,e,l;
return g.G(function(m){switch(m.C){case 1:return t=g.s6(),u={context:g.O3(),videoPlaybackPositionEntities:x,lastSyncTimestampUsec:T},H=g.K2(SSF),g.PX(m,2),E={oY:!0},g.v(m,g.QK(t,u,H,void 0,E),4);case 4:I=m.Z;g.cX(m,3);break;case 2:Z=g.Yq(m);if(Z instanceof g.Nk)throw e="VPPS network manager error: "+Z.message,sj(e,Z),Error(e);sj("VPPS fetch request error",Z);throw Error("VPPS fetch request error");case 3:l=F5(I);if(I)l!==void 0&&hI(l,"position sync");else throw sj("Network request failed for position sync"),
Error("Network request failed for position sync");return m.return(I)}})},Uzb=function(x,T,t){var u,H,I,E,Z,e,l,m;
return g.G(function(d){switch(d.C){case 1:u=g.s6();var M=t.refreshData,A=t.isEnqueuedForExpiredStreamUrlRefetch,R=t.cR,Y=t.offlineSourceData,b=t.mediaCapabilities,z={entityKey:x};M&&(z.refreshData=M);A&&(z.isExpiredStreamUrlRefetch=A);R&&(z.downloadParameters=R);Y&&(z.offlineSourceData=Y);M={context:g.sT(T),signatureTimestamp:20144,videos:[z]};b&&(M.mediaCapabilities=b);H=M;I=g.K2(YSV);g.PX(d,2);Z={oY:!0};return g.v(d,g.QK(u,H,I,void 0,Z),4);case 4:E=d.Z;g.cX(d,3);break;case 2:e=g.Yq(d);if(e instanceof
g.Nk)throw l="GetPDE network manager error: "+e.message,sj(l,e),Error(l);sj("GetPDE fetch request error",e);throw Error("GetPDE fetch request error");case 3:m=F5(E);if(E)m!==void 0&&hI(m,"PDE");else throw sj("Network request failed for PDE"),Error("Network request failed for PDE");return d.return(E)}})},F5=function(x){var T;
return(T=x.errorMetadata)==null?void 0:T.status},hI=function(x,T){T=T?" for "+T:"";
if(x===0)throw x="Empty response body"+T,sj(x),Error(x);x="Response with error"+T;sj(x);throw Error(x);},lKy=function(x){var T,t,u,H,I,E,Z,e;
return g.G(function(l){switch(l.C){case 1:return T=g.s6(),t=ltV(x),u=g.K2(b5C),g.PX(l,2),I={oY:!0},g.v(l,g.QK(T,t,u,void 0,I),4);case 4:H=l.Z;g.cX(l,3);break;case 2:E=g.Yq(l);if(E instanceof g.Nk)throw Z="offlinePlaylistSyncCheck network manager error: "+E.message,sj(Z,E),Error(Z);sj("offlinePlaylistSyncCheck fetch request error",E);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:e=F5(H);if(!H)throw sj("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(e!==void 0)hI(e,"playlist sync");else if(!H.offlinePlaylistSyncCheckDatas||!H.offlinePlaylistSyncCheckDatas.length)throw sj("No data for playlist sync"),Error("No data for playlist sync");return l.return(H.offlinePlaylistSyncCheckDatas.map(function(m){return m.offlinePlaylistSyncCheckData}))}})},vS=function(x){this.C=x},rpC=function(x,T){var t,u,H,I,E,Z;
return g.G(function(e){switch(e.C){case 1:t=new Map,u=g.S(T),H=u.next();case 2:if(H.done){e.lG(4);break}I=H.value;E=t;Z=E.set;return g.v(e,x.Z(I),5);case 5:Z.call(E,I,e.Z);H=u.next();e.lG(2);break;case 4:return e.return(t)}})},VA=function(x,T,t,u,H,I){T=g.$Q(T,t);
u=Object.assign({},I,{priority:u,retryScheduleIntervalsInSeconds:H});return{actionType:x,entityKey:T,actionMetadata:u}},GR=function(x,T,t,u,H,I){this.status=x;
this.C=T;this.K=t;this.Z=u;this.j=H;this.downloadState=I},zI9=function(x,T,t){this.C=x;
this.Cf=T;this.j=t},hIb=function(x,T){var t,u,H,I,E,Z,e,l,m;
return g.G(function(d){switch(d.C){case 1:return t=T.entityKey,H=(u=g.N(T.actionMetadata,La))==null?void 0:u.isEnqueuedForExpiredStreamUrlRefetch,g.PX(d,2),I=void 0,g.v(d,ks9(x,T),4);case 4:I=d.Z;g.PX(d,5);var M=(M=g.N(T.actionMetadata,La))?{maximumDownloadQuality:M.maximumDownloadQuality}:void 0;return g.v(d,Uzb(t,x.Cf,{isEnqueuedForExpiredStreamUrlRefetch:H,cR:M,offlineSourceData:I}),7);case 7:E=d.Z;g.cX(d,6,2);break;case 5:return g.Yq(d,2),Z=Ej(T)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",sj("PDE handleAdd error"),d.return(na(T,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Z,"DOWNLOAD_STATE_FAILED"));case 6:return g.v(d,FL0(x,E,T),8);case 8:return d.return(na(T,!0,E.orchestrationActions));case 2:return e=g.Yq(d),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.lo&&e.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sj("PDE handleAdd error"),d.return(na(T,!1,void 0,l,m,"DOWNLOAD_STATE_FAILED"))}})},Gs0=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX;
return g.G(function(xq){switch(xq.C){case 1:return t=T.entityKey,u=g.u1(t).entityId,g.v(xq,fD(x.C,{mode:"readonly",c9:!0},function(J){var X=yH(J,t,"playbackData"),c=yH(J,g.$Q(u,"offlineVideoPolicy"),"offlineVideoPolicy");J=yH(J,g.$Q(u,"transfer"),"transfer");return g.SD.all([X,c,J])}),2);
case 2:H=xq.Z;I=g.S(H);E=I.next().value;Z=I.next().value;e=I.next().value;l=E;m=Z;d=e;if(!l||!m)return xq.return(na(T,!0));M=[];Y=((R=l)==null?0:R.playerResponseJson)?JSON.parse(l.playerResponseJson):null;if(!(d&&Y&&x.Cf.B("html5_refresh_deprecated_downloads"))){xq.lG(3);break}A=vJP(x,Y,d);return g.v(xq,V5F(x,d),4);case 4:M=xq.Z;case 3:b={lastPlayerResponseTimestampSeconds:l.playerResponseTimestamp,offlineToken:m.offlineToken,formatIds:M};z={};if((F=d)==null?0:F.maximumDownloadQuality)z.maximumDownloadQuality=
d.maximumDownloadQuality;g.PX(xq,5);V=void 0;return g.v(xq,ks9(x,T),7);case 7:return V=xq.Z,g.PX(xq,8),g.v(xq,Uzb(t,x.Cf,{refreshData:b,cR:z,offlineSourceData:V,mediaCapabilities:A}),10);case 10:B=xq.Z;g.cX(xq,9,5);break;case 8:return g.Yq(xq,5),D=Ej(T)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",sj("PDE handleRefresh error"),xq.return(na(T,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,
"DOWNLOAD_STATE_FAILED"));case 9:return g.v(xq,FL0(x,B,T),11);case 11:return xq.return(na(T,!0,B.orchestrationActions));case 5:return f=g.Yq(xq),O="PDE handleRefresh error",f instanceof Error&&(O="PDE handleRefresh error: "+f.message),sH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",HX="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.lo&&f.type==="QUOTA_EXCEEDED"&&(sH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",HX="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
sj(O),xq.return(na(T,!1,void 0,sH,HX,"DOWNLOAD_STATE_FAILED"))}})},ks9=function(x,T){var t,u,H,I;
return g.G(function(E){if(E.C==1)return t=g.u1(T.entityKey).entityId,u=g.$Q(t,"videoDownloadContextEntity"),g.v(E,KD(x.C,u,"videoDownloadContextEntity"),2);H=E.Z;return(I=H)!=null&&I.offlineModeType?E.return({offlineModeType:H.offlineModeType}):E.return(void 0)})},FL0=function(x,T,t){var u,H,I,E,Z;
return g.G(function(e){if(e.C==1){if(!T.frameworkUpdates||!g.N(T.frameworkUpdates,Yf))return e.return();if(!(g.N(T.frameworkUpdates,Yf).mutations&&g.N(T.frameworkUpdates,Yf).mutations.length>0&&g.N(T.frameworkUpdates,Yf).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return e.lG(2);u=g.u1(g.N(T.frameworkUpdates,Yf).mutations[0].entityKey).entityId;return g.v(e,Uj(x.C,u),3)}if(e.C!=2){H=e.Z;I=g.N(t.actionMetadata,La);if(Z=(E=I)==null?void 0:E.playlistId)H.playlistId=Z;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.f1(x.Cf)?g.v(e,cS(u,x.C,t,x.j,H),2):g.L2(x.Cf)?g.v(e,bp(u,x.C,t,x.j),2):e.lG(2)}return g.v(e,uJy(g.N(T.frameworkUpdates,Yf)),0)})},na=function(x,T,t,u,H,I){return new GR(T?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Ej(x),t,u,H,I)},vJP=function(x,T,t){T=Dnb(x.Cf,t.cotn,T);
t=g.HV(T);return g.FVm(T,t,x.Cf)},V5F=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M;
return g.G(function(A){if(A.C==1)return t=[],g.v(A,fD(x.C,{mode:"readonly",c9:!0},function(R){var Y=[],b=T.offlineVideoStreams;if(b){b=g.S(b);for(var z=b.next();!z.done;z=b.next())Y.push(yH(R,z.value,"offlineVideoStreams"))}return g.SD.all(Y)}),2);
if(u=A.Z)for(H=g.S(u),I=H.next();!I.done;I=H.next())if(E=I.value,Z=void 0,(Z=E)==null?0:Z.streamsProgress)for(e=E.streamsProgress,l=0;l<e.length;l++)m=e[l],d=JSON.parse(m.formatStreamBytes),M={itag:d.itag,lmt:d.lastModified,xtags:d.xtags},t.push(M);return A.return(t)})},LL9=function(x,T){this.C=x;
this.Cf=T},nJM=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A;
return g.G(function(R){switch(R.C){case 1:return t=Ej(T),g.v(R,Xg(x.C,"videoPlaybackPositionEntity"),2);case 2:u=R.Z;if(u.length===0)return R.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.PX(R,3);return g.v(R,B2.getInstance(),5);case 5:H=R.Z;if(!H)throw Error("prefStorage is undefined");return g.v(R,H.get("psi"),6);case 6:return I=R.Z,e=(Z=(E=I)==null?void 0:E.c6)!=null?Z:"0",g.v(R,cpC(u,e),7);case 7:return l=R.Z,m={isPaused:l.watchHistoryPaused,c6:l.syncTimestampUsec},g.v(R,H.set("psi",
m),8);case 8:if(m.isPaused){R.lG(9);break}d=g.N(l.frameworkUpdates,Yf);if(!l.frameworkUpdates||!d){R.lG(9);break}return g.v(R,uJy(d),9);case 9:g.cX(R,4);break;case 3:return M=g.Yq(R),A="PPE handleRefresh error: "+(M instanceof Error?M.message:"unknown error"),sj(A),R.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return R.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},gJd=function(x,T){var t,u,H,I,E,Z,e,l;
return g.G(function(m){switch(m.C){case 1:return t=Ej(T),u=g.u1(T.entityKey).entityId,g.PX(m,2),g.v(m,B2.getInstance(),4);case 4:H=m.Z;if(!H)throw Error("prefStorage is undefined");return g.v(m,H.get("psi"),5);case 5:I=m.Z;E=g.N(T.actionMetadata,aK0);if(((Z=I)==null?void 0:Z.isPaused)!==!1||(e=E)==null||!e.lastPlaybackPositionSeconds){m.lG(6);break}l={key:g.$Q(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:E.lastPlaybackPositionSeconds};return g.v(m,w1(x.C,l,"videoPlaybackPositionEntity"),
6);case 6:g.cX(m,3);break;case 2:return g.Yq(m),m.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},BTC=function(x,T){var t,u,H;
return g.G(function(I){switch(I.C){case 1:t=Ej(T);g.PX(I,2);u=g.u1(T.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")return g.v(I,xn3(x.C),5);H=g.$Q(u,"videoPlaybackPositionEntity");return g.v(I,XD9(x.C,H),5);case 5:g.cX(I,3);break;case 2:return g.Yq(I),I.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},WLy=function(x,T){this.api=x;
this.C=T;this.logger=new g.t$("woffle");this.Z=!1;this.yF={Cr:this.Cr};this.logger.debug("Initialized OfflineMediaManager")},Dzd=function(x){return g.G(function(T){return T.return(ZEd(x))})},ypV=function(x){var T;
return g.G(function(t){if(t.C==1)return g.v(t,g.tAV(x),2);T=t.Z;return t.return(T.filter(function(u){return!!u.url}).map(function(u){return u.url}))})},aB=function(x,T){var t=g.kc(T);
if(t===1||t===0)return Promise.resolve();(t=NTC(x,T))&&t.stopVideo();x.j=0;return Dzd(T)},gA=function(x,T,t,u){t=t===void 0?!1:t;
u=u===void 0?!0:u;var H=typeof T==="string"?T:T.videoDetails.videoId;g.kc(H)===2&&((T=NTC(x,H))?T.stopVideo():x.logger.info(function(){return"Corresponding player for "+H+" not found. Pausing anyway"}),g.F4(H,2),x.j=2,t?Jp0(x.C):u&&CIE(x.C))},NTC=function(x,T){var t;
return((t=x.player)==null?void 0:t.getVideoData().videoId)===T?x.player:null},Qmb=function(x,T,t){T.getPlayerResponse();
g.F4(T.videoId,2);x.j=2;x.Z=!1;var u;(u=x.player)==null||u.dispose();x.player=x.api.XJ(T);T={};x.player.gR((T.localmediachange=x.jr,T.signatureexpired=x.AL,T.statechange=x.lkc,T),x);var H=x.Cr(t);x.player.Ow(g.uG(H,H,!0,"m"),!1);x.logger.debug(function(){return"Starting headless playback with quality: "+H});
x.player.Ou(!1)},pYE=function(x,T){this.C=x;
this.Cf=T},fK9=function(x,T){var t,u;
return g.G(function(H){switch(H.C){case 1:return t=Ej(T),g.v(H,KD(x.C,T.entityKey,"transfer"),2);case 2:if(u=H.Z)return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.PX(H,3);return g.v(H,O5C(x,T),5);case 5:g.cX(H,4);break;case 3:return g.Yq(H),H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},wYE=function(x,T){var t,u;
return g.G(function(H){switch(H.C){case 1:return t=Ej(T),g.v(H,KD(x.C,T.entityKey,"transfer"),2);case 2:u=H.Z;if(!u||u.transferState!=="TRANSFER_STATE_COMPLETE")return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.PX(H,3);return g.v(H,O5C(x,T,!0),5);case 5:g.cX(H,4);break;case 3:return g.Yq(H),H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},KLE=function(x,T){var t,u,H,I,E,Z,e,l,m,d;
return g.G(function(M){switch(M.C){case 1:return t=Ej(T),u=g.u1(T.entityKey).entityId,g.v(M,fD(x.C,{mode:"readonly",c9:!0},function(A){var R=yH(A,T.entityKey,"transfer");A=yH(A,g.$Q(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SD.all([R,A])}),2);
case 2:H=M.Z;I=g.S(H);E=I.next().value;Z=I.next().value;e=E;l=Z;if(!e||e.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return M.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.PX(M,3);e.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.v(M,w1(x.C,e,"transfer"),5);case 5:m=g.u1(e.key).entityId;IB({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:m,ZN:e,offlineModeType:(d=l)==null?void 0:d.offlineModeType});g.cX(M,
4);break;case 3:return g.Yq(M),M.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},O5C=function(x,T,t){t=t===void 0?!1:t;
var u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z;return g.G(function(F){switch(F.C){case 1:return u=g.N(T.actionMetadata,XYF),H=g.u1(T.entityKey).entityId,I=g.$Q(H,"downloadStatusEntity"),g.v(F,fD(x.C,{mode:"readonly",c9:!0},function(V){var B=yH(V,I,"downloadStatusEntity");V=yH(V,g.$Q(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SD.all([B,V])}),2);
case 2:return E=F.Z,Z=g.S(E),e=Z.next().value,l=Z.next().value,m=e,d=l,M="TRANSFER_STATE_TRANSFER_IN_QUEUE",((A=m)==null?void 0:A.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(M="TRANSFER_STATE_PAUSED_BY_USER"),b={key:T.entityKey,transferState:M,cotn:g.Sq(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(R=u)==null?void 0:R.maximumDownloadQuality,preferredAudioTrack:(Y=u)==null?void 0:Y.preferredAudioTrack,transferRetryCount:0,isRefresh:t,hasLoggedFirstStarted:!1},g.v(F,fD(x.C,
{mode:"readwrite",c9:!0},function(V){var B=[];t&&B.push(QH(V,g.$Q(H,"offlineVideoStreams")));B.push(CD(V,b,"transfer"));return g.SD.all(B)}),3);
case 3:if(!t){F.lG(4);break}return g.v(F,Dzd(H),4);case 4:IB({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:H,ZN:b,offlineModeType:(z=d)==null?void 0:z.offlineModeType}),g.RV(F)}})},TXb=function(x,T,t,u){if(!x.action.entityKey)throw Error("entityKey is missing.");
var H=g.u1(x.action.entityKey);H={entityType:H.A3,entityId:H.entityId,offlineOrchestrationActionType:x.action.actionType,orchestrationAction:{orchestrationActionId:x.actionId}};T&&(H.offlineOrchestrationActionResult=T.status,H.isRetryable=t?!1:T.C,T.j&&(H.offlineOrchestrationFailureReason=xVM(T.j,H.isRetryable)));var I,E;if((I=x.action.actionMetadata)==null?0:(E=I.offlineLoggingData)==null?0:E.offlineModeType)H.offlineModeType=x.action.actionMetadata.offlineLoggingData.offlineModeType;u&&(H.additionalOrchestrationActions=
u.map(function(Z){return{orchestrationActionId:Z.actionId}}));
return H},xVM=function(x,T){return x!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||T?x==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&T?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":x:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},ow3=function(x,T){var t={offlineOrchestrationContext:TXb(x)};
T=A2y(T,t);RNV(MwF(),T,x.rootActionId)},tEb=function(x,T,t,u){u=u===void 0?[]:u;
T={offlineOrchestrationContext:TXb(x,T,t,u)};T=A2y(3,T);RNV(MwF(),T,x.rootActionId)},sp0=function(){this.actions=[]},ujb=function(x,T){T=g.S(T);
for(var t=T.next();!t.done;t=T.next())t=t.value,ow3(t,1),x.actions.push(t);x.actions.sort(x.C)},$Vb=function(x,T){if(T)for(var t=0;t<x.actions.length;t++)if(T==="!*$_ALL_ENTITIES_!*$"&&x.actions[t].actionId!==T||T!=="!*$_ALL_ENTITIES_!*$"&&x.actions[t].rootActionId===T&&x.actions[t].actionId!==T)x.actions.splice(t,1),t--},Ht0=function(x,T){x=g.S(x.actions);
for(var t=x.next();!t.done;t=x.next())if(t.value.actionId===T)return!0;return!1},BS=function(x,T,t,u,H){g.W.call(this);
var I=this;this.Z=x;this.uG=T;this.ZZ=t;this.N=u;this.Cf=H;this.C=new sp0;this.D=new g.Qq;this.j=new g.wX(function(){I.retry()});
this.J=NaN;this.T=!1;this.yF={mYm:function(){return I.C},
Vx:function(){return I.D},
Xfu:function(){return I.j},
retry:function(){return I.retry()}};
g.y(this,this.j);this.S=this.Z.observe(this.jY.bind(this))},EwV=function(x,T,t,u,H){var I;
return g.G(function(E){if(E.C==1)return I=new BS(x,T,t,u,H),g.v(E,itb(I),2);IuP(I);return E.return(I)})},IuP=function(x){var T=x.C.actions[0];
return x.K?((T==null?void 0:T.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&x.K[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(x.T=!0),Promise.resolve()):qXd(x)},qXd=function(x){var T,t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z;
return g.G(function(F){switch(F.C){case 1:if(x.K)throw Error("Already processing an action");if(x.T9())return F.return();T=x.C.actions.shift();Vwb(x.ZZ,!T);if(T===void 0)return F.return();T.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&T.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&$Vb(x.C,T.actionId);t="";T.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&T.rootActionId===T.actionId&&(t=T.actionId);u=[T];x.K=u;if(H=x.uG[T.entityType]){F.lG(2);break}x.K=
void 0;return g.v(F,qXd(x),3);case 3:return F.return();case 2:I=g.S(u);for(E=I.next();!E.done;E=I.next())Z=E.value,ow3(Z,2);g.PX(F,4,5);return g.v(F,rpC(H,u.map(function(V){return V.action})),7);
case 7:e=F.Z,l=g.S(u),m=l.next();case 8:if(m.done){F.lG(10);break}d=m.value;M=e.get(d.action);return g.v(F,ZtE(x,d,M),9);case 9:m=l.next();F.lG(8);break;case 10:$Vb(x.C,t);case 5:g.UH(F);x.K=void 0;g.b3(F,6);break;case 4:return A=g.Yq(F),sj("Orchestration error",A),g.PX(F,12),g.v(F,jpM(x,u),14);case 14:g.cX(F,5);break;case 12:R=g.Yq(F);sj("Orchestration retry error",R);Y=g.S(u);for(b=Y.next();!b.done;b=Y.next())z=b.value,z.retryScheduleIndex<3&&ujb(x.C,[z]);F.lG(5);break;case 6:return g.v(F,qXd(x),
0)}})},ZtE=function(x,T,t){var u,H,I,E,Z,e,l,m,d,M,A,R;
return g.G(function(Y){switch(Y.C){case 1:u=T.retryScheduleIndex+2===3;if(t.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Y.lG(2);break}if(t.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Y.lG(0);break}tEb(T,t,u);if(t.C&&T.retryScheduleIndex+1<3)return g.v(Y,jpM(x,[T]),0);I=((H=t)==null?0:H.Z)?t.Z:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";E={entityKey:T.action.entityKey,failureReason:I};Z=void 0;g.f1(x.Cf)?Z="mainVideoDownloadStateEntity":g.L2(x.Cf)&&(Z="musicTrackDownloadMetadataEntity");
if(!Z||!t.downloadState){Y.lG(7);break}e=g.u1(T.action.entityKey).entityId;return g.v(Y,e_(e,Z,x.Z,t.downloadState),7);case 7:$f(x.N,E);if(t.downloadState==="DOWNLOAD_STATE_FAILED"&&x.Cf.B("html5_auto_retry_failed_pde_actions")){Y.lG(0);break}sj("Orchestration result is not retryable, deleting action");return g.v(Y,XD9(x.Z,RB(T).key),0);case 2:l=void 0;try{l=(m=t.K)==null?void 0:m.map(function(b){return x.createAction(b,T)})}catch(b){return tEb(T,t,u),d={entityKey:T.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},$f(x.N,d),sj("Orchestration subactions creation error",b),Y.return()}tEb(T,t,u,l);if(!l){Y.lG(12);break}M=l.map(function(b){return RB(b)});
A=0;case 13:if(!(A<l.length)||x.T){Y.lG(15);break}return g.v(Y,fD(x.Z,{mode:"readwrite",c9:!0},function(b){var z=[];z.push(y8h(b,M.slice(A,A+10),"offlineOrchestrationActionWrapperEntity"));return g.SD.all(z)}),16);
case 16:A+=10;Y.lG(13);break;case 15:if(x.T)return x.T=!1,Y.return();case 12:return R=RB(T),g.v(Y,XD9(x.Z,R.key),17);case 17:ow3(T,4),g.RV(Y)}})},dVd=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A;
return g.G(function(R){t=[];u=Infinity;H=4E3;I=g.S(T);for(E=I.next();!E.done;E=I.next())Z=E.value,e=Number(Z.enqueueTimeSec),l=eOy(e),m=Z.retryScheduleIndex,d=m!=null&&m>0,l>0&&d?(u=Math.min(u,e),H=Math.min(l,H)):t.push(Z);isFinite(u)&&(!x.j.isActive()||u<x.J)&&(x.J=u,x.j.start(H));x.D.TV()||(M=t.length,t=t.filter(function(Y){var b;Y=((b=Y.actionProto)==null?void 0:b.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!lud.includes(Y)}),A=t.length<M,!x.j.isActive()&&A&&x.j.start(1));
t.length>0&&mVd(x,t);return g.v(R,IuP(x),0)})},A_y=function(x){var T,t,u,H,I,E,Z;
return g.G(function(e){if(e.C==1)return g.v(e,MEh(x),2);T=e.Z;t=[];u=g.S(T);for(H=u.next();!H.done;H=u.next())I=H.value,E=g.u1(I.key),Z=E.entityId,Ht0(x.C,Z)||t.push(I);return g.v(e,dVd(x,t),0)})},eOy=function(x){x=x*1E3-Date.now();
return x>4E3?4E3:x},jpM=function(x,T){var t,u,H;
return g.G(function(I){t=g.S(T);for(u=t.next();!u.done;u=t.next()){H=u.value;var E=void 0,Z=void 0,e=((Z=H.action)==null?void 0:(E=Z.actionMetadata)==null?void 0:E.retryScheduleIntervalsInSeconds)||[1,2,4];E=1;H.retryScheduleIndex<e.length&&(E=e[H.retryScheduleIndex]);H.C=E*1E3+Date.now();H.retryScheduleIndex++}return g.v(I,ROd(x,T),0)})},itb=function(x){var T;
return g.G(function(t){if(t.C==1)return g.v(t,Xg(x.Z,"offlineOrchestrationActionWrapperEntity"),2);T=t.Z;return g.v(t,dVd(x,T),0)})},mVd=function(x,T){T.length!==0&&T.forEach(function(t){t=AI(t);
t.retryScheduleIndex<3&&ujb(x.C,[t])})},MEh=function(x,T){var t;
return g.G(function(u){if(u.C==1)return g.v(u,Xg(x.Z,"offlineOrchestrationActionWrapperEntity",T),2);t=u.Z;return u.return(t.filter($nV))})},ROd=function(x,T){if(T.length===0)return Promise.resolve([]);
T=T.map(function(t){return RB(t)});
return K0y(x.Z,T)},PN0=function(x){this.qj=x;
this.C=void 0},SXh=function(x,T){var t,u,H,I;
return g.G(function(E){t=T.videoId;u=!0;if(T.captionTracks.length)H=Wnh(T),x.C=new g.FC(x.qj,T,H);else if(T.qz)I=g.ZF4(T),x.C=new g.v8(x.qj,T.qz,t,I,T.I8,T.eventId),u=T.I8;else return E.return();return E.return(new Promise(function(Z){var e;(e=x.C)==null||e.e$({wV:function(){return g.G(function(l){if(l.C==1)return g.v(l,x.wV(t,u),2);Z();g.RV(l)})},
Ce:function(){}})}))})},c_E=function(x){var T;
return g.G(function(t){if(t.C==1)return g.v(t,q9d(x),2);T=t.Z;return t.return(!!T&&T.length>0)})},WS=function(x){g.W.call(this);
this.C=x;this.Z=this.C.observe(this.j.bind(this))},YXb=function(x,T){var t,u,H,I,E,Z,e;
return g.G(function(l){switch(l.C){case 1:if(T.length===0)return l.return([]);t=T.map(function(m){return g.$Q(m,"transfer")});
return g.v(l,Xg(x.C,"transfer",t),2);case 2:u=l.Z;H=u.filter($nV).map(function(m){return g.u1(m.key).entityId});
I=T.filter(function(m){return H.indexOf(m)===-1});
if(I.length===0)return l.return([]);E=g.S(I);Z=E.next();case 3:if(Z.done){l.lG(5);break}e=Z.value;return g.v(l,Dzd(e),4);case 4:Z=E.next();l.lG(3);break;case 5:return l.return(I)}})},r_3=function(x,T,t,u,H,I){var E,Z,e;
return g.G(function(l){E="STREAM_TYPE_UNKNOWN";t.video&&t.audio?(E="STREAM_TYPE_AUDIO_AND_VIDEO",sj("unexpected stream type")):t.video&&!t.audio?E="STREAM_TYPE_VIDEO":!t.video&&t.audio&&(E="STREAM_TYPE_AUDIO");Z=g.$Q(T,"offlineVideoStreams");e={numBytesDownloaded:H.toFixed(),numTotalBytes:I.toFixed(),streamType:E,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(u),itag:E==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(t.itag):void 0};return g.v(l,fD(x,{mode:"readwrite",c9:!0},
function(m){var d=yH(m,Z,"offlineVideoStreams"),M=yH(m,g.$Q(T,"transfer"),"transfer");return g.SD.all([d,M]).then(function(A){A=g.S(A);var R=A.next().value;A=A.next().value;if(!A)return QH(m,Z).then(function(){});
var Y=UVP(R);R=btd(R,u,e,Z);var b=CD(m,R,"offlineVideoStreams");UVP(R)>Y&&(A.lastProgressTimeMs=Date.now().toString());Y=[b];A.offlineVideoStreams||(A.offlineVideoStreams=[]);A.offlineVideoStreams.indexOf(Z)===-1&&(A.offlineVideoStreams.push(Z),Y.push(CD(m,A,"transfer")));return g.SD.all(Y)})}),0)})},zOh=function(x,T){var t,u,H,I,E;
return g.G(function(Z){if(Z.C==1)return t=g.$Q(T,"offlineVideoStreams"),g.v(Z,KD(x,t,"offlineVideoStreams"),2);u=Z.Z;if(!u||!u.streamsProgress)return Z.return();H=g.S(u.streamsProgress);for(I=H.next();!I.done;I=H.next())E=I.value,E.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",E.numTotalBytes!==E.numBytesDownloaded&&(E.numBytesDownloaded=E.numTotalBytes);return g.v(Z,w1(x,u,"offlineVideoStreams"),0)})},btd=function(x,T,t,u){if(x&&x.streamsProgress){u=x;
a:{T=T.itag+";"+T.xtags;for(var H=x.streamsProgress,I=0;I<H.length;I++){var E=JSON.parse(H[I].formatStreamBytes);if(E.itag+";"+E.xtags===T){H[I]=t;t=H;break a}}H.push(t);t=H}u.streamsProgress=t}else x={key:u,streamsProgress:[t]};return x},UVP=function(x){if(x==null?0:x.streamsProgress){var T=0;
x=x.streamsProgress;for(var t=0;t<x.length;t++){var u=x[t];isNaN(Number(u.numBytesDownloaded))?sj("stream progress bytes number invalid"):T+=Number(u.numBytesDownloaded)}return T}return 0},kny=function(x,T,t,u){g.W.call(this);
var H=this;this.Z=x;this.api=T;this.G9=t;this.jY=u;this.D=new g.Qq;this.K=new g.wX(function(){H.C&&H.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&H.D.TV()&&((H.C.transferRetryCount||0)<3?gA(H.N,H.T,!1,!1):aB(H.N,H.T.videoDetails.videoId),H.Is("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.ZZ=this.Om=0;this.S=this.J=!1;this.AQ=g.Z9(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.nf=new g.nj(this);this.yF={EZU:function(){return H.K},
FwY:function(){return H.jY},
Vx:function(){return H.D}};
this.uG=this.Z.observe(this.kY.bind(this));this.N=new WLy(T,this);this.mu=new PN0(T);this.Hv=new WS(this.Z);this.QU=this.D.listen("publicytnetworkstatus-online",this.Ep.bind(this));this.hQ=this.D.listen("publicytnetworkstatus-offline",this.fxW.bind(this));this.S=this.api.Y().B("html5_less_transfer_processing_logs");g.y(this,this.nf);this.nf.V(T,"offlinetransferpause",this.nxj);g.f1(this.api.Y())?this.j="mainVideoDownloadStateEntity":g.L2(this.api.Y())&&(this.j="musicTrackDownloadMetadataEntity")},
FfP=function(x){return g.G(function(T){if(T.C==1)T=g.v(T,It9(),2);
else{var t=x.Hv;var u=g.z8();u=Object.keys(u);t=YXb(t,u);T=g.v(T,t,0)}return T})},yA=function(x,T){T=T===void 0?!1:T;
var t;return g.G(function(u){if(u.C==1){if(x.C)throw Error("Already downloading a video");x.ZZ=0;x.J=!1;return g.v(u,hOC(x),2)}return u.C!=4?(t=u.Z,GdE(x.G9,!t),t&&x.D.TV()?T?g.v(u,new Promise(function(H){g.lP(H,1E3)}),4):u.lG(4):(!t&&x.C&&Db(x),u.lG(0))):g.v(u,vwb(x,t),0)})},VE9=function(x){return g.G(function(T){if(T.C==1)return x.T?g.v(T,aB(x.N,x.T.videoDetails.videoId),3):T.lG(0);
Db(x);g.RV(T)})},Gnh=function(x,T){var t,u,H;
return g.G(function(I){switch(I.C){case 1:return g.PX(I,2),(t=!!T.captionTracks.length||!!T.qz)?g.v(I,c_E(T.videoId),4):I.return();case 4:return(u=I.Z)?I.return():g.v(I,SXh(x.mu,T),5);case 5:g.cX(I,0);break;case 2:H=g.Yq(I),sj("Caption downloading error",H,T.cotn),g.RV(I)}})},vwb=function(x,T){var t,u,H,I,E,Z;
return g.G(function(e){switch(e.C){case 1:if(x.J)return e.return();x.J=!0;x.C=T;t=g.u1(x.C.key);u=t.entityId;H=void 0;if(x.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.v(e,Nh(x,u),7);if(x.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||x.C.transferRetryCount||x.C.hasLoggedFirstStarted){e.lG(3);break}return g.v(e,Nh(x,u),5);case 5:return H=e.Z,x.C.hasLoggedFirstStarted=!0,g.v(e,Lfb(x),6);case 6:LUy({videoId:u,ZN:x.C,offlineModeType:H},void 0,void 0,!0);e.lG(3);break;case 7:H=e.Z,
IB({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:u,ZN:x.C,offlineModeType:H});case 3:return g.v(e,nwy(x),8);case 8:return I=null,g.PX(e,9),g.v(e,au0(x,T),11);case 11:I=e.Z;x.T=I;g.cX(e,10);break;case 9:return E=g.Yq(e),sj("error getting player response",E,T.cotn),g.v(e,x.Is("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return e.return();case 10:return Z=Dnb(x.api.Y(),T.cotn,I),g.v(e,Gnh(x,Z),13);case 13:return g.v(e,ypV(Z.videoId),
14);case 14:Z.aM=e.Z,Qmb(x.N,Z,T.maximumDownloadQuality),x.K.start(108E5),g.RV(e)}})},hOC=function(x){var T,t;
return g.G(function(u){if(u.C==1)return g.v(u,Xg(x.Z,"transfer"),2);T=u.Z;t=T.filter(gw0).sort(BXC);return t.length===0?u.return():u.return(t[0])})},nwy=function(x){var T,t,u;
return g.G(function(H){if(H.C==1){if(!x.C)return JI(x,"onTransferStart"),H.return();x.K.start(108E5);return g.v(H,Ca(x,"TRANSFER_STATE_TRANSFERRING"),2)}T=x.C;return(u=((t=T)==null?0:t.key)?g.u1(T.key).entityId:"")&&x.j?g.v(H,e_(u,x.j,x.Z,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):H.lG(0)})},Jp0=function(x){var T,t,u,H;
g.G(function(I){switch(I.C){case 1:if(!x.C){JI(x,"onTransferPausedByUser");I.lG(2);break}T=x.C;x.K.stop();return g.v(I,Ca(x,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:u=((t=T)==null?0:t.key)?g.u1(T.key).entityId:"";if(!u||!x.j){I.lG(4);break}return g.v(I,e_(u,x.j,x.Z,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.v(I,Nh(x,u),6);case 6:H=I.Z,n4C({videoId:u,ZN:T,offlineModeType:H});case 2:Db(x),yA(x),g.RV(I)}})},CIE=function(x){var T,t,u;
g.G(function(H){if(H.C==1){if(!x.C)return JI(x,"onTransferPausedByNetwork"),H.return();x.K.stop();return g.v(H,Ca(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(H.C!=3)return T=x.C,(u=((t=T)==null?0:t.key)?g.u1(T.key).entityId:"")&&x.j?g.v(H,e_(u,x.j,x.Z,"DOWNLOAD_STATE_PAUSED"),3):H.lG(3);Db(x);g.RV(H)})},Wfd=function(x){var T,t,u,H,I;
g.G(function(E){switch(E.C){case 1:if(!x.C)return JI(x,"onTransferComplete"),E.return();T=x.C;x.K.stop();if(!T||!x.T){E.lG(2);break}t=Dnb(x.api.Y(),T.cotn,x.T);return g.v(E,Gnh(x,t),2);case 2:return g.v(E,Ca(x,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:H=((u=T)==null?0:u.key)?g.u1(T.key).entityId:"";if(!H||!x.j){E.lG(5);break}return g.v(E,e_(H,x.j,x.Z,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.v(E,zOh(x.Z,H),7);case 7:return g.v(E,Nh(x,H),8);case 8:I=E.Z,IB({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:H,ZN:T,offlineModeType:I}),Db(x),yA(x),g.RV(E)}})},DV9=function(x,T,t){var u,H;
g.G(function(I){switch(I.C){case 1:if(!x.C)return JI(x,"onTransferProgress: "+T),I.return();if(x.C.transferState==="TRANSFER_STATE_TRANSFERRING"){I.lG(2);break}return g.v(I,nwy(x),2);case 2:u=Date.now();if(!(u-x.Om>1E3)){I.lG(4);break}x.Om=u;return g.v(I,r_3(x.Z,t.videoId,t.Z,t.AC,t.bytesDownloaded,t.C),5);case 5:if(x.S&&!(x.S&&u-x.ZZ>x.AQ)){I.lG(4);break}x.ZZ=u;return g.v(I,Nh(x,T),7);case 7:H=I.Z,LUy({videoId:T,ZN:x.C,offlineModeType:H},t.bytesDownloaded,t.C);case 4:x.K.start(108E5),g.RV(I)}})},
y_y=function(x){var T=(x.C.transferRetryCount||0)<3;
T&&(x=x.C,x.transferRetryCount=(x.transferRetryCount||0)+1);return T},NXF=function(x,T){T=T===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":T;
var t,u,H,I;return g.G(function(E){if(E.C==1)return x.C||JI(x,"setTransferToFailed: "+T),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T==="TRANSFER_FAILURE_REASON_NETWORK"?t="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":T==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.v(E,Ca(x,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",T),2);if(E.C!=3)return $f(x.jY,{entityKey:(u=x.C)==null?void 0:u.key,failureReason:t}),
H=x.C?g.u1(x.C.key).entityId:"",g.v(E,Nh(x,H),3);I=E.Z;var Z={videoId:H,ZN:x.C,offlineModeType:I},e=T,l={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};e&&(l.transferFailureReason=e,l.failureReason=atC(e));IB(l,Z);g.RV(E)})},Ca=function(x,T,t,u){var H;
return g.G(function(I){if(I.C==1){if(!x.C)return JI(x,"saveTransferState: "+T),I.return();x.C.transferState=T;x.C.failureReason=u;g.PX(I,2);return g.v(I,Lfb(x,function(E){return t?NZ(E,"offlineVideoStreams",x.C.offlineVideoStreams).then(function(Z){for(var e=g.S(Z),l=e.next();!l.done;l=e.next())if((l=l.value)&&l.streamsProgress){l=g.S(l.streamsProgress);for(var m=l.next();!m.done;m=l.next())m.value.streamState=t}return y8h(E,Z.filter(function(d){return!!d}),"offlineVideoStreams")}):g.SD.resolve(void 0)}),
4)}if(I.C!=2)return g.cX(I,0);
H=g.Yq(I);return H instanceof g.lo&&H.type==="QUOTA_EXCEEDED"?g.v(I,x.Is("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):I.lG(0)})},Lfb=function(x,T){var t;
return g.G(function(u){if(!x.C)return u.return();t=x.C;return g.v(u,fD(x.Z,{mode:"readwrite",c9:!0},function(H){var I=[CD(H,t,"transfer")];T&&I.push(T(H));return g.SD.all(I)}),0)})},Db=function(x){x.C=void 0;
x.T=void 0;x.K.stop()},au0=function(x,T){var t,u,H,I,E;
return g.G(function(Z){if(Z.C==1)return t=g.u1(T.key),u=t.entityId,H=g.$Q(u,"playbackData"),g.v(Z,KD(x.Z,H,"playbackData"),2);I=Z.Z;if((E=I)==null?0:E.playerResponseJson)return Z.return(JSON.parse(I.playerResponseJson));throw Error("No PlayerResponse found");})},JI=function(x,T){x.api.kc("woffle",{mcte:T});
sj("missing current transfer entity.")},Nh=function(x,T){var t,u,H;
return g.G(function(I){if(I.C==1)return g.v(I,KD(x.Z,g.$Q(T,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);t=I.Z;return I.return((H=(u=t)==null?void 0:u.offlineModeType)!=null?H:void 0)})},gw0=function(x){return J_9[x.transferState]!==void 0},BXC=function(x,T){var t=J_9[x.transferState],u=J_9[T.transferState];
return t!==u?t-u:Number(x.enqueuedTimestampMs)-Number(T.enqueuedTimestampMs)},QA=function(x,T){var t=this;
this.Cf=x;this.api=T;this.D=new g.Qq;this.T=new g.mn;this.yF={AY:function(){return t.j.yF.AY()},
Vx:function(){return t.D},
Nt7:function(){return t.j},
P6:function(){return t.P6()},
Jz:function(){return t.Jz()},
Wq:function(){return t.Wq()},
kI:function(){return t.kI()},
bd:function(){return t.bd()},
Fj:function(u){return t.Fj(u)}};
this.j=new FU3(function(){return CNb(t)},function(){t.Wq()},this.api.BE(),this.api.B.bind(this.api));
this.C=new up(this.api);hNC(this.j)},CNb=function(x){return g.G(function(T){x.api.XW("onOrchestrationBecameLeader");
return g.v(T,x.Jz(),0)})},psy=function(x){var T,t;
return g.G(function(u){if(u.C==1)return g.v(u,xf(),2);if(u.C!=3){T=u.Z;if(!T)return sj("PES is undefined"),u.return();x.Z=new kny(T,x.api,x.j,x.C);t=x.YW(T);return g.v(u,EwV(T,t,x.j,x.C,x.Cf),3)}x.N=u.Z;return g.v(u,Qp0(x),0)})},Qp0=function(x){var T;
return g.G(function(t){switch(t.C){case 1:if(!x.Z)return sj("transferManager is undefined"),t.return();if(x.Z.C){t.lG(2);break}return g.v(t,yA(x.Z),2);case 2:if(!x.Cf.B("woffle_enable_main_downloads_library")){t.lG(4);break}return g.v(t,x.tZ(),4);case 4:if(!x.Cf.B("html5_offline_playback_position_sync")){t.lG(6);break}return g.v(t,x.oy(),7);case 7:return g.v(t,x.Fj(864E5),6);case 6:return g.v(t,x.refreshAllStaleEntities(43200,!0),9);case 9:return g.v(t,x.JF(),10);case 10:if(!x.Cf.B("html5_retry_downloads_for_expiration")){t.lG(11);
break}return g.v(t,x.bd(),11);case 11:return x.J=g.mF(function(){x.refreshAllStaleEntities(43200,!0);x.JF()},9E5),g.wx(g.XM(),function(){return x.kI()}),g.v(t,xf(),13);
case 13:return T=t.Z,g.v(t,kd0(T),14);case 14:v4b(x.j),g.RV(t)}})},Ot9=function(){var x,T,t,u,H,I;
return g.G(function(E){switch(E.C){case 1:return g.v(E,xf(),2);case 2:x=E.Z;if(!x)return E.return([]);T=Date.now()/1E3;return g.v(E,Xg(x,"offlineVideoPolicy"),3);case 3:t=E.Z,u=g.S(t),H=u.next();case 4:if(H.done){E.lG(6);break}I=H.value;if(!(I.expirationTimestamp&&Number(I.expirationTimestamp)<T)){E.lG(5);break}I.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";I.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.v(E,w1(x,I,"offlineVideoPolicy"),5);
case 5:H=u.next();E.lG(4);break;case 6:return E.return(t.map(function(Z){return Z.key}))}})},pa=function(x,T,t,u,H){var I,E,Z;
return g.G(function(e){if(e.C==1)return g.v(e,xf(),2);I=e.Z;if(!I)return e.return([]);E=T.map(function(l){var m=g.$Q(l,t);m={actionType:u,entityKey:m,actionMetadata:Object.assign({},y2V(),H)};u!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(m.actionMetadata.priority=0);l=new Mh(t,l,m);return RB(l)});
Z=K0y(I,E);hNC(x.j);return e.return(Z)})},fu9=function(x,T,t,u){var H,I,E,Z,e,l,m,d;
return g.G(function(M){switch(M.C){case 1:H=[],I=g.S(T),E=I.next();case 2:if(E.done){M.lG(4);break}Z=E.value;if(Z.upToDate||t&&!Z.shouldAutoSyncMetadata||!Z.playlistId){M.lG(3);break}e={};switch(u){case "mainPlaylistEntity":l={nextAutoRefreshIntervalSeconds:Z.checkInSeconds,autoSync:t};e={mainPlaylistEntityActionMetadata:l};break;case "musicPlaylist":m={autoSync:t},e={musicPlaylistEntityActionMetadata:m}}return g.v(M,pa(x,[Z.playlistId],u,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e),6);case 6:(d=
M.Z)&&H.push.apply(H,g.U(d));case 3:E=I.next();M.lG(2);break;case 4:return M.return(H)}})},wsM=function(x,T){var t;
return g.G(function(u){return T.length?(t=y2V(),g.gp(t,La,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x.api.kc("qrd",{v:T.length}),u.return(pa(x,T,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t))):u.return([])})},Kfb=function(x,T,t){this.C=x;
this.Cf=T;this.j=t},TYM=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F;
return g.G(function(V){switch(V.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,I=[],g.PX(V,2),g.v(V,Xs9(x,H),4);case 4:I=V.Z;if(!(x.Cf.B("woffle_enable_main_downloads_library")&&((E=I)==null?0:E.length))){V.lG(5);break}return g.v(V,oJ0(x.C,[T.entityKey]),5);case 5:g.cX(V,3);break;case 2:return Z=g.Yq(V),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.lo&&Z.type==="QUOTA_EXCEEDED"?(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):sj("Playlist add error"),V.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,e,l));case 3:m=[];if(!x.Cf.B("html5_offline_prevent_redownload_downloaded_video")){V.lG(7);break}return g.v(V,WUE(x.C,"mainVideoEntity",I),8);case 8:I=V.Z;case 7:if((d=I)==null?0:d.length)for(M=g.S(I),A=M.next();!A.done;A=M.next())if(R=A.value,Y=R.offlineVideoData,b=void 0,(b=Y)==null?0:b.videoId)z=void 0,F=Number(((z=T.actionMetadata)==null?void 0:z.priority)||
0)+1,m.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"mainVideoEntity",F,Oj,xBF(T,Y,H)));return V.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,m))}})},tWh=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h,L,a,Ti,u3,$q,n,qf,m3,IV,hf,e0,gy,jQ,Jf,BI,Ig,hC,Ng,EA,DY,WI,ye,An,qg,ha,jz,vd,G2,Ls,b7,KA,NL,tm,UX,W9;
return g.G(function(eQ){switch(eQ.C){case 1:return t=Ej(T),u=T.entityKey,H=g.u1(u).entityId,I=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(eQ,Xg(x.C,"mainPlaylistEntity"),5)):g.v(eQ,KD(x.C,u,"mainPlaylistEntity"),4);case 4:(Z=eQ.Z)&&I.push(Z);eQ.lG(3);break;case 5:I=eQ.Z;case 3:if((e=I)==null||!e.length)return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));l=g.N(T.actionMetadata,oP3);d=(m=l)==null?void 0:m.nextAutoRefreshIntervalSeconds;A=(M=l)==null?void 0:M.autoSync;R=[];b=Y=
!0;z=!1;if(!E&&A===!1){eQ.lG(6);break}g.PX(eQ,7);return g.v(eQ,mzV(0,!!A,!0,I),9);case 9:R=eQ.Z;g.cX(eQ,8);break;case 7:F=g.Yq(eQ);if(!(F instanceof Error&&F.message==="No data")){F instanceof Error&&F.message==="Empty response body"&&sj(F.message);eQ.lG(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.v(eQ,ftE(x.C,T,x.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.v(eQ,pfP(H,x.C,T,x.j),8);case 8:if(!R.length||!E&&R[0].playlistId!==H)return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));case 6:if(E){V=[];B=g.S(R);for(D=B.next();!D.done;D=B.next())f=D.value,f.upToDate||A&&!f.shouldAutoSyncMetadata||!f.playlistId||(O={nextAutoRefreshIntervalSeconds:f.checkInSeconds,autoSync:A},V.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f.playlistId,"mainPlaylistEntity",0,Oj,{mainPlaylistEntityActionMetadata:O})));return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,V))}R.length&&(sH=R[0],z=!!sH.upToDate,A&&(Y=(HX=sH.shouldAutoSyncMetadata)!=null?HX:!0,b=(xq=sH.shouldAutoSyncVideos)!=
null?xq:!0,sH.checkInSeconds&&(d=sH.checkInSeconds)));if(z||!Y)return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));J=[];X=I[0];if(!X.downloadState){c=void 0;eQ.lG(15);break}return g.v(eQ,KD(x.C,X.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:c=eQ.Z;case 15:return C=c,PE=((WX=C)==null?0:WX.addedTimestampMillis)?String(C.addedTimestampMillis):void 0,g.PX(eQ,17),g.v(eQ,Xs9(x,H,PE,d),19);case 19:J=eQ.Z;g.cX(eQ,18);break;case 17:j0=g.Yq(eQ);if(!(j0 instanceof Error&&
j0.message==="No data for playlist")){if(j0 instanceof Error&&j0.message==="Empty response body for playlist")sj(j0.message);else return r5="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",j0 instanceof g.lo&&j0.type==="QUOTA_EXCEEDED"&&(r5="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,r5,w5));eQ.lG(18);
break}return g.v(eQ,pfP(H,x.C,T,x.j),18);case 18:if(!b)return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));tM=[];md=new Map;if((r=J)==null?0:r.length)for(k=g.S(J),h=k.next();!h.done;h=k.next())L=h.value,a=L.offlineVideoData,Ti=void 0,((Ti=a)==null?0:Ti.videoId)&&md.set(a.videoId,a);u3=new Map;$q=[];if((n=X)==null?0:(qf=n.videos)==null?0:qf.length)for(m3=g.S(X.videos),IV=m3.next();!IV.done;IV=m3.next())if(hf=IV.value,e0=JSON.parse(g.u1(hf).entityId),gy=e0.videoId)md.has(gy)?(u3.set(gy,
md.get(gy)),md.delete(gy)):$q.push(gy);Jf=Number(((jQ=T.actionMetadata)==null?void 0:jQ.priority)||0)+1;BI=g.S(md.entries());for(Ig=BI.next();!Ig.done;Ig=BI.next())hC=Ig.value,Ng=g.S(hC),EA=Ng.next().value,DY=Ng.next().value,WI=EA,ye=DY,tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",WI,"mainVideoEntity",Jf,Oj,xBF(T,ye,H)));An=g.S(u3.entries());for(qg=An.next();!qg.done;qg=An.next())ha=qg.value,jz=g.S(ha),vd=jz.next().value,G2=jz.next().value,Ls=vd,b7=G2,tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ls,"mainVideoEntity",Jf,Oj,xBF(T,b7,H)));KA=g.S($q);for(NL=KA.next();!NL.done;NL=KA.next())tm=NL.value,UX={playlistId:H},W9={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:UX},tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",tm,"mainVideoEntity",0,Oj,W9));return eQ.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,tM))}})},sc3=function(x,T){var t,u,H,I;
return g.G(function(E){switch(E.C){case 1:return t=Ej(T),g.PX(E,2),u=g.u1(T.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.v(E,ftE(x.C,T,x.j,(H=T.actionMetadata)==null?void 0:(I=H.offlineLoggingData)==null?void 0:I.offlineDeleteReason),5):g.v(E,pfP(u,x.C,T,x.j),6);case 6:if(!x.Cf.B("woffle_enable_main_downloads_library")){E.lG(5);break}return g.v(E,t59(x.C,T.entityKey),5);case 5:g.cX(E,3);break;case 2:return g.Yq(E),E.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},Xs9=function(x,T,t,u){var H,I,E,Z,e,l,m;
return g.G(function(d){switch(d.C){case 1:return g.v(d,eIC([T]),2);case 2:return H=d.Z,g.v(d,uzb(x,H[0],t,u),3);case 3:return I=d.Z,E=I.mainPlaylistEntity,Z=I.G3U,l=C2d(E,(e=Z)==null?void 0:e.avatar),g.PX(d,4),g.v(d,S_(l),6);case 6:g.cX(d,5);break;case 4:m=g.Yq(d),m instanceof Error&&m.message==="Failed to fetch"&&sj(m.message);case 5:return d.return(H[0].videos)}})},uzb=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B;
return g.G(function(D){switch(D.C){case 1:H=Date.now().toString();t||(t=H);I=T.videos;E=T.playlistId;Z=[];e=[];if(I)for(l=g.S(I),m=l.next();!m.done;m=l.next()){d=m.value;M=d.offlineVideoData;if(!M||!M.videoId)throw sj("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");A=M.videoId;R={videoId:A,playlistId:E};Y={id:g.$Q(JSON.stringify(R),"mainPlaylistVideoEntity"),video:g.$Q(A,"mainVideoEntity")};Z.push(Y);e.push(Y.id)}z={key:g.$Q(E,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:t,lastSyncedTimestampMillis:H};F={key:g.$Q(E,"mainPlaylistEntity"),playlistId:E,videos:e,title:T.title,thumbnailStyleData:$BM(T),visibility:He0(T),downloadState:z.key};T.channel&&(V=T.channel.offlineChannelData,b=ie9(g.$Q(E,"ytMainChannelEntity"),V),F.channelOwner=b.id);((B=F)==null?0:B.entityMetadata)?(F.entityMetadata.offlineLastModifiedTimestampSeconds=T.lastModifiedTimestamp,u&&(F.entityMetadata.nextAutoRefreshIntervalSeconds=String(u))):F&&(F.entityMetadata={nextAutoRefreshIntervalSeconds:u?
String(u):void 0,offlineLastModifiedTimestampSeconds:T.lastModifiedTimestamp});g.PX(D,2);return g.v(D,fD(x.C,{mode:"readwrite",c9:!0},function(f){var O=CD(f,F,"mainPlaylistEntity"),sH=CD(f,z,"mainPlaylistDownloadStateEntity");O=[O,sH];sH=g.S(Z);for(var HX=sH.next();!HX.done;HX=sH.next())O.push(CD(f,HX.value,"mainPlaylistVideoEntity"));b&&O.push(CD(f,b,"ytMainChannelEntity"));return g.SD.all(O)}),4);
case 4:g.cX(D,3);break;case 2:throw g.Yq(D),sj("PES failure for playlist"),Error("PES failure for playlist");case 3:return D.return({mainPlaylistEntity:F,G3U:b,XZG:Z})}})},ie9=function(x,T){return{id:x,
channelId:T.channelId,title:T.title,avatar:T.thumbnail}},$BM=function(x){var T=[],t=x.videos;
t&&t.length>0&&T.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:t[0].offlineVideoData.thumbnail}}});if((x=x.additionalMetadadatas)&&x.length>0)for(x=g.S(x),t=x.next();!t.done;t=x.next()){var u=t.value.offlineBundleItemPlaylistData,H=void 0;t=(H=u)==null?void 0:H.style;H=void 0;u={collageThumbnail:{coverThumbnail:(H=u)==null?void 0:H.coverThumbnail}};switch(t){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":T.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:u});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":T.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":T.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":T.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:u})}}return T},He0=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},xBF=function(x,T,t){T={offlineVideoData:T,
playlistId:t};if(x=g.N(x.actionMetadata,oP3))T.maximumDownloadQuality=x.maximumDownloadQuality;return{mainVideoEntityActionMetadata:T}},IoV=function(x,T,t){this.C=x;
this.Cf=T;this.j=t},Zeh=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R;
return g.G(function(Y){switch(Y.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,I=g.N(T.actionMetadata,fa),Z=!((E=I)==null?0:E.playlistId),g.PX(Y,2),g.v(Y,EPP(x,H,void 0,(e=I)==null?void 0:e.offlineVideoData,Z),4);case 4:g.cX(Y,3);break;case 2:return l=g.Yq(Y),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.lo&&l.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,m,d));case 3:M=1;M=Number(((A=T.actionMetadata)==null?void 0:A.priority)||0)+1;var b=(b=g.N(T.actionMetadata,fa))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;R=VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",M,qRy,b);return Y.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,[R]))}})},jcM=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F;
return g.G(function(V){switch(V.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,g.v(V,KD(x.C,T.entityKey,"mainVideoEntity"),2);case 2:I=V.Z;if(!I){E=void 0;V.lG(3);break}return g.v(V,KD(x.C,I.downloadState,"mainVideoDownloadStateEntity"),4);case 4:E=V.Z;case 3:Z=E;if(!I||!Z)return V.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.PX(V,5);return g.v(V,EPP(x,H,Z.addedTimestampMillis,(l=g.N(T.actionMetadata,fa))==null?void 0:l.offlineVideoData),7);case 7:m=1;m=Number(((d=
T.actionMetadata)==null?void 0:d.priority)||0)+1;e=VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",m,qRy);g.cX(V,6);break;case 5:M=g.Yq(V);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")sj(M.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.lo&&M.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,A,R));V.lG(6);break}return g.v(V,Uj(x.C,H),9);case 9:Y=V.Z;b=g.N(T.actionMetadata,fa);if(F=(z=b)==null?void 0:z.playlistId)Y.playlistId=F;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.v(V,cS(H,x.C,T,x.j,Y),6);case 6:return V.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,e?[e]:void 0))}})},eLF=function(x,T){var t,u,H,I,E,Z,e,l,m,d;
return g.G(function(M){switch(M.C){case 1:return t=Ej(T),g.PX(M,2),u=g.u1(T.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.v(M,ftE(x.C,T,x.j,(m=T.actionMetadata)==null?void 0:(d=m.offlineLoggingData)==null?void 0:d.offlineDeleteReason),5):g.v(M,Uj(x.C,u),6);case 6:H=M.Z;I=g.N(T.actionMetadata,fa);if(Z=(E=I)==null?void 0:E.playlistId)H.playlistId=Z;H.offlineDeleteReason=(e=T.actionMetadata)==null?void 0:(l=e.offlineLoggingData)==null?void 0:l.offlineDeleteReason;return g.v(M,cS(u,x.C,T,x.j,H),7);
case 7:if(!x.Cf.B("woffle_enable_main_downloads_library")){M.lG(5);break}return g.v(M,t59(x.C,T.entityKey),5);case 5:g.cX(M,3);break;case 2:return g.Yq(M),M.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},EPP=function(x,T,t,u,H){var I,E,Z,e,l,m;
return g.G(function(d){switch(d.C){case 1:if(I=u){d.lG(2);break}return g.v(d,jmF([T]),3);case 3:E=d.Z,I=E[0];case 2:return g.v(d,lo3(x,I,t,H),4);case 4:Z=d.Z;e=Z.mainVideoEntity;l=Z.channelEntity;g.PX(d,5);var M=dA(e.thumbnail),A=dA(l.avatar);return g.v(d,S_(M.concat(A)),7);case 7:g.cX(d,0);break;case 5:m=g.Yq(d),m instanceof Error&&m.message==="Failed to fetch"&&sj(m.message),g.RV(d)}})},lo3=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M,A,R,Y,b;
return g.G(function(z){switch(z.C){case 1:t||(t=Date.now().toString());I=(H=T.channel)==null?void 0:H.offlineChannelData;E={id:g.$Q(T.videoId,"ytMainChannelEntity"),channelId:I.channelId,title:I.title,avatar:I.thumbnail};Z={key:g.$Q(T.videoId,"mainVideoDownloadStateEntity"),playbackData:g.$Q(T.videoId,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.$Q(T.videoId,"videoDownloadContextEntity")};e={key:g.$Q(T.videoId,"videoPlaybackPositionEntity"),videoId:T.videoId,lastPlaybackPositionSeconds:"0"};
x.Cf.B("html5_offline_playback_position_sync")&&(l={playbackPosition:e.key});m=g.$Q(T.videoId,"mainVideoEntity");d={key:m,videoId:T.videoId,title:T.title,thumbnail:T.thumbnail,localizedStrings:{viewCount:T.shortViewCountText},userState:l,lengthSeconds:T.lengthSeconds?Number(T.lengthSeconds):void 0,publishedTimestampMillis:T.publishedTimestamp?(Number(T.publishedTimestamp)*1E3).toString():void 0,formattedDescription:T.description,owner:E.id,downloadState:Z.key};if(!x.Cf.B("woffle_enable_main_downloads_library")||
!u){z.lG(2);break}return g.v(z,TTy(x.C,[m]),3);case 3:if(R=z.Z)M=R.mainDownloadsLibraryEntity,A=R.mainDownloadsListEntity;case 2:return b=Bld,Y={key:g.$Q(T.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.gp(Z,b,Y),g.v(z,fD(x.C,{mode:"readwrite",c9:!0},function(F){var V=CD(F,E,"ytMainChannelEntity"),B=CD(F,Z,"mainVideoDownloadStateEntity"),D=CD(F,d,"mainVideoEntity");V=[V,B,D];x.Cf.B("html5_offline_playback_position_sync")&&(B=CD(F,e,"videoPlaybackPositionEntity"),
V.push(B));M&&(B=CD(F,M,"mainDownloadsLibraryEntity"),V.push(B));A&&(B=CD(F,A,"mainDownloadsListEntity"),V.push(B));Y&&(F=CD(F,Y,"downloadStatusEntity"),V.push(F));return g.SD.all(V)}),4);
case 4:return z.return({mainVideoEntity:d,channelEntity:E})}})},mBV=function(x,T,t){this.C=x;
this.Cf=T;this.j=t},MWh=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X;
return g.G(function(c){switch(c.C){case 1:return t=Ej(T),u=[],g.v(c,B2.getInstance(),2);case 2:H=c.Z;if(!H){c.lG(3);break}return g.v(c,H.get("sdois"),4);case 4:return I=c.Z,g.v(c,(Z=H)==null?void 0:Z.get("lmqf"),5);case 5:E=c.Z;case 3:g.PX(c,6);if(I===void 0)throw Error("prefStorage or opt-in state is undefined");e=[];if(I){c.lG(8);break}return g.v(c,xzy(x.C),9);case 9:e=c.Z,e.reverse();case 8:if(!e.length){c.lG(10);break}l=g.S(e);m=l.next();case 11:if(m.done){c.lG(10);break}d=m.value;if(!d){c.lG(12);
break}M=g.u1(d).entityId;return g.v(c,Uj(x.C,M),14);case 14:return A=c.Z,A.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.v(c,cS(M,x.C,{entityKey:d,actionType:T.actionType},x.j,A),12);case 12:m=l.next();c.lG(11);break;case 10:return g.v(c,M59(I,(R=E)!=null?R:"SD"),16);case 16:return Y=c.Z,g.v(c,wf9(Y),17);case 17:b=Xfd(Y);if(!x.Cf.B("woffle_enable_main_downloads_library")){c.lG(18);break}if(I){c.lG(19);break}return g.v(c,t59(x.C,g.Lp),19);case 19:return g.v(c,oJ0(x.C,[g.Lp]),18);
case 18:if((z=b)==null?0:z.length)for(F=g.S(b),V=F.next();!V.done;V=F.next())if(D=B=V.value,f=D.actionType,O=D.entityKey,sH=D.actionMetadata,f&&O&&sH&&!g.N(sH,dBF)){f==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(sH.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(HX=g.N(B.actionMetadata,fa))HX.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",B.actionMetadata=Object.assign({},B.actionMetadata,{mainVideoEntityActionMetadata:HX});u.push(B)}g.cX(c,7);break;
case 6:return xq=g.Yq(c),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",xq instanceof g.lo&&xq.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,J,X));case 7:return c.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,u))}})},Aw0=function(){QA.apply(this,arguments);
this.S="mainVideoEntity"},RLC=function(x,T,t){T=T===void 0?43200:T;
t=t===void 0?!0:t;var u=u===void 0?!1:u;var H,I,E;return g.G(function(Z){switch(Z.C){case 1:if(!x.D.TV())return Z.return([]);H=[];g.PX(Z,2);return g.v(Z,mzV(T,t,u),4);case 4:H=Z.Z;g.cX(Z,3);break;case 2:I=g.Yq(Z),I instanceof Error&&I.message==="No data"||I instanceof Error&&I.message==="Empty response body"&&sj(I.message);case 3:return E=fu9(x,H,t,"mainPlaylistEntity"),Z.return(E)}})},PY0=function(x,T,t,u){u=u===void 0?!1:u;
var H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F;return g.G(function(V){switch(V.C){case 1:return H=[],g.v(V,dzM(),2);case 2:return(I=V.Z)||u?g.v(V,Ap3(T,t),3):V.return([]);case 3:E=V.Z;if((Z=E)==null||!Z.length)return V.return([]);e={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};l=g.S(E);m=l.next();case 4:if(m.done){V.lG(6);break}M=d=m.value;A=M.actionType;R=M.entityKey;Y=M.actionMetadata;if(!(A&&R&&Y)||g.N(Y,dBF)){V.lG(5);break}A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.offlineLoggingData=
e);b=g.u1(R);z=b.entityId;return g.v(V,pa(x,[z],"mainVideoEntity",A,Y),8);case 8:F=V.Z,H=H.concat(F);case 5:m=l.next();V.lG(4);break;case 6:return V.return(H)}})},SRC=function(x,T){this.C=x;
this.j=T},YRh=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z;
return g.G(function(F){switch(F.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,I=[],g.PX(F,2),g.v(F,cwE(x,H),4);case 4:I=F.Z;if((E=I)==null||!E.length){F.lG(5);break}return g.v(F,i5F(x.C,T.entityKey),5);case 5:g.cX(F,3);break;case 2:return Z=g.Yq(F),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.lo&&Z.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
F.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,e,l));case 3:return m=[],g.v(F,WUE(x.C,"musicTrack",I),7);case 7:I=F.Z;if(I.length)for(d=g.S(I),M=d.next();!M.done;M=d.next())if(A=M.value,R=A.offlineVideoData,Y=void 0,(Y=R)==null?0:Y.videoId)b=void 0,z=Number(((b=T.actionMetadata)==null?void 0:b.priority)||0)+1,m.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"musicTrack",z,wA,kf(T,R,H)));return F.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,m))}})},
UBV=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h,L,a,Ti,u3,$q,n,qf,m3,IV,hf,e0,gy,jQ,Jf,BI,Ig,hC,Ng,EA,DY;
return g.G(function(WI){switch(WI.C){case 1:return t=Ej(T),u=T.entityKey,H=g.u1(u).entityId,I=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(WI,Xg(x.C,"musicAlbumRelease"),5)):g.v(WI,KD(x.C,u,"musicAlbumRelease"),4);case 4:(Z=WI.Z)&&I.push(Z);WI.lG(3);break;case 5:I=WI.Z;case 3:if((e=I)==null||!e.length)return WI.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));if(E){l=[];m=g.S(I);for(d=m.next();!d.done;d=m.next())M=d.value,A=g.u1(M.id).entityId,l.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
A,"musicAlbumRelease",0,wA));return WI.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,l))}R=[];Y=I[0];b=void 0;if(!Y.downloadMetadata){WI.lG(6);break}return g.v(WI,KD(x.C,Y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:z=WI.Z,b=Number((V=(F=z)==null?void 0:F.addedTimestampMillis)!=null?V:"0")/1E3;case 6:return g.PX(WI,8),g.v(WI,cwE(x,H,(B=b)==null?void 0:B.toString()),10);case 10:R=WI.Z;g.cX(WI,9);break;case 8:D=g.Yq(WI);if(!(D instanceof Error&&D.message===
"No data")){if(D instanceof Error&&D.message==="Empty response body")sj(D.message);else return f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.lo&&D.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),WI.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,f,O));WI.lG(9);break}return g.v(WI,rA(H,"musicAlbumRelease",x.C,
T,x.j),9);case 9:sH=[];HX=new Map;if((xq=R)==null?0:xq.length)for(J=g.S(R),X=J.next();!X.done;X=J.next())c=X.value,C=c.offlineVideoData,WX=void 0,((WX=C)==null?0:WX.videoId)&&HX.set(C.videoId,C);PE=new Map;j0=[];if((r5=Y)==null?0:(w5=r5.tracks)==null?0:w5.length)for(tM=g.S(Y.tracks),md=tM.next();!md.done;md=tM.next())if(r=md.value,k=g.u1(r).entityId)HX.has(k)?(PE.set(k,HX.get(k)),HX.delete(k)):j0.push(k);L=Number(((h=T.actionMetadata)==null?void 0:h.priority)||0)+1;a=g.S(HX.entries());for(Ti=a.next();!Ti.done;Ti=
a.next())u3=Ti.value,$q=g.S(u3),n=$q.next().value,qf=$q.next().value,m3=n,IV=qf,sH.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m3,"musicTrack",L,wA,kf(T,IV)));hf=g.S(PE.entries());for(e0=hf.next();!e0.done;e0=hf.next())gy=e0.value,jQ=g.S(gy),Jf=jQ.next().value,BI=jQ.next().value,Ig=Jf,hC=BI,sH.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Ig,"musicTrack",L,wA,kf(T,hC)));Ng=g.S(j0);for(EA=Ng.next();!EA.done;EA=Ng.next())DY=EA.value,sH.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",DY,
"musicTrack",0,wA));return WI.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,sH))}})},bey=function(x,T){var t,u;
return g.G(function(H){switch(H.C){case 1:return t=Ej(T),g.PX(H,2),u=g.u1(T.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.v(H,zR(x.C,T,x.j),5):g.v(H,rA(u,"musicAlbumRelease",x.C,T,x.j),6);case 6:return g.v(H,IK9(x.C,T.entityKey),5);case 5:g.cX(H,3);break;case 2:return g.Yq(H),H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},cwE=function(x,T,t){var u,H,I;
return g.G(function(E){switch(E.C){case 1:return g.v(E,eIC([T]),2);case 2:return u=E.Z,g.v(E,rwP(x,u[0],t),3);case 3:return H=E.Z,I=dA(H.thumbnailDetails),g.v(E,S_(I),4);case 4:return E.return(u[0].videos)}})},rwP=function(x,T,t){var u,H,I,E,Z,e,l,m,d,M,A,R,Y,b;
return g.G(function(z){if(z.C==1){u=T.additionalMetadadatas;H=void 0;if(u&&u.length>0)for(I=g.S(u),E=I.next();!E.done;E=I.next())if(Z=E.value,Z.offlineMusicPlaylistData){H=Z.offlineMusicPlaylistData;break}e=T.playlistId;l=EJb(T);m=l.CL;d=l.bE;M=t?(Number(t)*1E3).toString():Date.now().toString();A=T.lastModifiedTimestamp?(Number(T.lastModifiedTimestamp)*1E3).toString():"0";R={id:g.$Q(e,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:d,lastModifiedTimestampMillis:A,addedTimestampMillis:M,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Y={id:g.$Q(e,"musicAlbumRelease"),title:T.title,audioPlaylistId:e,trackCount:T.totalVideoCount,tracks:m,downloadMetadata:R.id};H&&(Y.thumbnailDetails=(b=H.albumHqThumbnail)!=null?b:H.albumArtistThumbnail,Y.artistDisplayName=H.albumArtistDisplayName,Y.releaseDate=H.albumReleaseDate,Y.contentRating={explicitType:H.albumReleaseExplicitType},Y.releaseType=H.albumReleaseType);return g.v(z,fD(x.C,{mode:"readwrite",c9:!0},function(F){var V=CD(F,Y,"musicAlbumRelease");
F=CD(F,R,"musicAlbumReleaseDownloadMetadataEntity");return g.SD.all([V,F])}),2)}return z.return(Y)})},zLE=function(x,T){this.C=x;
this.j=T},F5M=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z;
return g.G(function(F){switch(F.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,I=[],g.PX(F,2),g.v(F,koy(x,H),4);case 4:I=F.Z;if((E=I)==null||!E.length){F.lG(5);break}return g.v(F,i5F(x.C,T.entityKey),5);case 5:g.cX(F,3);break;case 2:return Z=g.Yq(F),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.lo&&Z.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
F.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,e,l));case 3:return m=[],g.v(F,WUE(x.C,"musicTrack",I),7);case 7:I=F.Z;if(I.length)for(d=g.S(I),M=d.next();!M.done;M=d.next())if(A=M.value,R=A.offlineVideoData,Y=void 0,(Y=R)==null?0:Y.videoId)b=void 0,z=Number(((b=T.actionMetadata)==null?void 0:b.priority)||0)+1,m.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"musicTrack",z,Ka,kf(T,R,H)));return F.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,m))}})},
hLE=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md,r,k,h,L,a,Ti,u3,$q,n,qf,m3,IV,hf,e0,gy,jQ,Jf,BI,Ig,hC,Ng,EA,DY,WI,ye,An,qg,ha,jz,vd,G2,Ls,b7,KA,NL;
return g.G(function(tm){switch(tm.C){case 1:return t=Ej(T),u=T.entityKey,H=g.u1(u).entityId,I=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(tm,Xg(x.C,"musicPlaylist"),5)):g.v(tm,KD(x.C,u,"musicPlaylist"),4);case 4:(Z=tm.Z)&&I.push(Z);tm.lG(3);break;case 5:I=tm.Z;case 3:if((e=I)==null||!e.length)return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));l=g.N(T.actionMetadata,qSh);d=(m=l)==null?void 0:m.autoSync;M=[];R=A=!0;Y=!1;b=void 0;if(!E&&d===!1){tm.lG(6);break}g.PX(tm,7);return g.v(tm,
RIb(0,!!d,!0,I),9);case 9:M=tm.Z;g.cX(tm,8);break;case 7:z=g.Yq(tm);if(!(z instanceof Error&&z.message==="No data")){z instanceof Error&&z.message==="Empty response body"&&sj(z.message);tm.lG(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.v(tm,zR(x.C,T,x.j),8):g.v(tm,rA(H,"musicPlaylist",x.C,T,x.j),8);case 8:if(!M.length||!E&&M[0].playlistId!==H)return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));case 6:if(E){F=[];V=g.S(M);for(B=V.next();!B.done;B=V.next())D=B.value,D.upToDate||
d&&!D.shouldAutoSyncMetadata||!D.playlistId||(f={autoSync:d},F.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"musicPlaylist",0,Ka,{musicPlaylistEntityActionMetadata:f})));return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,F))}M.length&&(O=M[0],Y=!!O.upToDate,d&&(A=(sH=O.shouldAutoSyncMetadata)!=null?sH:!0,R=(HX=O.shouldAutoSyncVideos)!=null?HX:!0,O.checkInSeconds&&(b=O.checkInSeconds)));if(Y||!A)return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));xq=[];J=I[0];X=void 0;if(!J.downloadMetadata){tm.lG(15);break}return g.v(tm,KD(x.C,J.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:c=tm.Z,X=Number((WX=(C=c)==null?void 0:C.addedTimestampMillis)!=null?WX:"0")/1E3;case 15:return g.PX(tm,17),g.v(tm,koy(x,H,(PE=X)==null?void 0:PE.toString(),b),19);case 19:xq=tm.Z;g.cX(tm,18);break;case 17:j0=g.Yq(tm);if(!(j0 instanceof Error&&j0.message==="No data")){if(j0 instanceof Error&&j0.message==="Empty response body")sj(j0.message);else return r5=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",j0 instanceof g.lo&&j0.type==="QUOTA_EXCEEDED"&&(r5="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,r5,w5));tm.lG(18);break}return g.v(tm,rA(H,"musicPlaylist",x.C,T,x.j),18);case 18:if(!R)return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));tM=[];md=new Map;if((r=xq)==null?0:r.length)for(k=g.S(xq),h=k.next();!h.done;h=k.next())L=h.value,a=L.offlineVideoData,Ti=void 0,((Ti=a)==null?0:Ti.videoId)&&md.set(a.videoId,a);u3=new Map;$q=[];if((n=J)==null?0:(qf=n.tracks)==null?0:qf.length)for(m3=g.S(J.tracks),IV=m3.next();!IV.done;IV=m3.next())if(hf=IV.value,e0=g.u1(hf).entityId)md.has(e0)?(u3.set(e0,md.get(e0)),md.delete(e0)):$q.push(e0);jQ=Number(((gy=T.actionMetadata)==null?void 0:gy.priority)||0)+1;Jf=g.S(md.entries());for(BI=Jf.next();!BI.done;BI=
Jf.next())Ig=BI.value,hC=g.S(Ig),Ng=hC.next().value,EA=hC.next().value,DY=Ng,WI=EA,tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",DY,"musicTrack",jQ,Ka,kf(T,WI)));ye=g.S(u3.entries());for(An=ye.next();!An.done;An=ye.next())qg=An.value,ha=g.S(qg),jz=ha.next().value,vd=ha.next().value,G2=jz,Ls=vd,tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G2,"musicTrack",jQ,Ka,kf(T,Ls)));b7=g.S($q);for(KA=b7.next();!KA.done;KA=b7.next())NL=KA.value,tM.push(VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
NL,"musicTrack",0,Ka));return tm.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,tM))}})},vP3=function(x,T){var t,u;
return g.G(function(H){switch(H.C){case 1:return t=Ej(T),g.PX(H,2),u=g.u1(T.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.v(H,zR(x.C,T,x.j),5):g.v(H,rA(u,"musicPlaylist",x.C,T,x.j),6);case 6:return g.v(H,IK9(x.C,T.entityKey),5);case 5:g.cX(H,3);break;case 2:return g.Yq(H),H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},koy=function(x,T,t,u){var H,I,E;
return g.G(function(Z){switch(Z.C){case 1:return g.v(Z,eIC([T]),2);case 2:return H=Z.Z,g.v(Z,VWb(x,H[0],t,u),3);case 3:return I=Z.Z,E=dA(I.thumbnailDetails),g.v(Z,S_(E),4);case 4:return Z.return(H[0].videos)}})},VWb=function(x,T,t,u){var H,I,E,Z,e,l,m,d,M;
return g.G(function(A){return A.C==1?(H=T.playlistId,I=EJb(T),E=I.CL,Z=I.bE,e=t?(Number(t)*1E3).toString():Date.now().toString(),l=T.lastModifiedTimestamp?(Number(T.lastModifiedTimestamp)*1E3).toString():"0",m={id:g.$Q(H,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:Z,lastModifiedTimestampMillis:l,addedTimestampMillis:e,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},d={id:g.$Q(H,"musicPlaylist"),title:T.title,playlistId:H,thumbnailDetails:T.thumbnail,visibility:Gob(T),trackCount:T.totalVideoCount,
tracks:E,downloadMetadata:m.id},u&&(((M=d)==null?0:M.entityMetadata)?d.entityMetadata.nextAutoRefreshIntervalSeconds=String(u):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:String(u)})),g.v(A,fD(x.C,{mode:"readwrite",c9:!0},function(R){var Y=CD(R,d,"musicPlaylist");R=CD(R,m,"musicPlaylistDownloadMetadataEntity");return g.SD.all([Y,R])}),2)):A.return(d)})},Gob=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},L5d=function(x,T){this.C=x;
this.j=T},BY9=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R;
return g.G(function(Y){switch(Y.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,I=g.N(T.actionMetadata,nP0),g.PX(Y,2),g.v(Y,ao0(x,H,void 0,(E=I)==null?void 0:E.track,(Z=I)==null?void 0:Z.albumRelease),4);case 4:if((e=I)==null?0:e.playlistId){Y.lG(5);break}return g.v(Y,i5F(x.C,T.entityKey),5);case 5:g.cX(Y,3);break;case 2:return l=g.Yq(Y),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.lo&&l.type==="QUOTA_EXCEEDED"&&
(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,m,d));case 3:A=Number(((M=T.actionMetadata)==null?void 0:M.priority)||0)+1;var b=(b=g.N(T.actionMetadata,nP0))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;R=VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",A,gPb,b);return Y.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t,[R]))}})},W5d=function(x,T){var t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b;
return g.G(function(z){switch(z.C){case 1:return t=Ej(T),u=g.u1(T.entityKey),H=u.entityId,g.v(z,KD(x.C,T.entityKey,"musicTrack"),2);case 2:I=z.Z;if(!I){E=void 0;z.lG(3);break}return g.v(z,KD(x.C,I.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:E=z.Z;case 3:Z=E;if(!I||!Z)return z.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));l=g.N(T.actionMetadata,nP0);g.PX(z,5);return g.v(z,ao0(x,H,Z.addedTimestampMillis,(m=l)==null?void 0:m.track,(d=l)==null?void 0:d.albumRelease),
7);case 7:A=Number(((M=T.actionMetadata)==null?void 0:M.priority)||0)+1;e=VA("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",A,gPb);g.cX(z,6);break;case 5:R=g.Yq(z);if(!(R instanceof Error&&R.message==="No data")){if(R instanceof Error&&R.message==="Empty response body")sj(R.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.lo&&R.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Y,b));z.lG(6);break}return g.v(z,bp(H,x.C,T,x.j),6);case 6:return z.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,e?[e]:void 0))}})},DB9=function(x,T){var t,u;
return g.G(function(H){switch(H.C){case 1:return t=Ej(T),g.PX(H,2),u=g.u1(T.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.v(H,zR(x.C,T,x.j),5):g.v(H,bp(u,x.C,T,x.j),6);case 6:return g.v(H,IK9(x.C,T.entityKey),5);case 5:g.cX(H,3);break;case 2:return g.Yq(H),H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new GR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},ao0=function(x,T,t,u,H){var I,E,Z,e,l,m;
return g.G(function(d){switch(d.C){case 1:if(I=u){d.lG(2);break}return g.v(d,jmF([T]),3);case 3:E=d.Z,Z=E[0],I=H5b(Z);case 2:return g.v(d,ywd(x,I,T,H,t),4);case 4:e=d.Z;l=e.musicTrackEntity;m=e.DR;var M=dA(l.thumbnailDetails),A=[];m&&(A=dA(m.thumbnailDetails));return g.v(d,S_(M.concat(A)),0)}})},ywd=function(x,T,t,u,H){var I;
return g.G(function(E){return E.C==1?(H||(H=Date.now().toString()),I={id:g.$Q(t,"musicTrackDownloadMetadataEntity"),playbackData:g.$Q(t,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.$Q(t,"videoDownloadContextEntity")},u&&(T.albumRelease=u.id),g.v(E,fD(x.C,{mode:"readwrite",c9:!0},function(Z){var e=[],l=CD(Z,I,"musicTrackDownloadMetadataEntity");e.push(l);l=CD(Z,T,"musicTrack");e.push(l);u&&(Z=CD(Z,u,"musicAlbumRelease"),e.push(Z));return g.SD.all(e)}),2)):E.C!=3?g.v(E,e_(t,"musicTrackDownloadMetadataEntity",
x.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):E.return({musicTrackEntity:T,
DR:u})})},X5=function(){QA.apply(this,arguments);
this.S="musicTrack"},NY9=function(x,T,t){T=T===void 0?43200:T;
t=t===void 0?!0:t;var u=u===void 0?!1:u;var H,I;return g.G(function(E){switch(E.C){case 1:if(!x.D.TV())return E.return([]);H=[];g.PX(E,2);return g.v(E,RIb(T,t,u),4);case 4:H=E.Z;g.cX(E,3);break;case 2:g.Yq(E);case 3:return I=fu9(x,H,t,"musicPlaylist"),E.return(I)}})},Jw9=function(){g.r_.apply(this,arguments);
var x=this;this.events=new g.nj(this);this.Cf=this.player.Y();this.yF={G5W:function(){return x.C},
rQ:function(){return x.rQ()},
sS:function(T){return x.sS(T)}}},CYM=function(x){var T;
x=g.N((T=x.getWatchNextResponse())==null?void 0:T.currentVideoEndpoint,g.KB);if(x==null?0:x.playlistId)var t=x.playlistId;return t},QcV=function(x,T){var t,u,H,I;
return g.G(function(E){if(E.C==1){t=T.clientPlaybackNonce;u={cpn:t,offlineSourceVisualElement:g.PW(T.Om||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};T.Z&&(u.videoFmt=Number(T.Z.itag));T.K&&(u.audioFmt=Number(T.K.itag));if((H=CYM(T))&&T.videoId){var Z=T.videoId;Z=H!=="PPSV"?Promise.resolve(!1):x.C.Wu(Z);E=g.v(E,Z,3)}else E=E.lG(2);return E}E.C!=2&&(I=E.Z)&&(u.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");x.Z=t;g.io("offlinePlaybackStarted",u);g.RV(E)})};
g.UT.prototype.XJ=g.tf(45,function(x){return this.app.XJ(x)});
g.Rb.prototype.XJ=g.tf(44,function(x){return g.Pm(this,9,x)});
g.P(aq,nD);g.i3.Object.defineProperties(aq.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(x){this.C.entityMetadata=x}}});
g.P(y5C,aq);y5C.prototype.Z=function(){return[]};
g.P(NaV,aq);NaV.prototype.Z=function(){return[]};
g.P(J5V,aq);J5V.prototype.Z=function(){return[]};
g.P(C7b,aq);C7b.prototype.Z=function(){return[]};
g.P(QA0,aq);QA0.prototype.Z=function(){var x=[];this.C.alternateChannel&&x.push(this.C.alternateChannel);this.C.alternateChannelList&&x.push.apply(x,g.U(this.C.alternateChannelList));this.C.oneofChannelEntity&&x.push(this.C.oneofChannelEntity);return[].concat(g.U(new Set(x)))};
g.P(pO9,aq);pO9.prototype.Z=function(){var x=[];this.C.entryCollection&&x.push(this.C.entryCollection);return[].concat(g.U(new Set(x)))};
g.P(Ok0,nD);Ok0.prototype.Z=function(){var x=[];this.C.video&&x.push(this.C.video);return[].concat(g.U(new Set(x)))};
g.P(fMd,aq);fMd.prototype.Z=function(){var x=[];this.C.parentPlaylist&&x.push(this.C.parentPlaylist);if(this.C.entries)for(var T=g.S(this.C.entries),t=T.next();!t.done;t=T.next())x.push.apply(x,g.U((new Ok0(t.value)).Z()));return[].concat(g.U(new Set(x)))};
g.P(wOE,aq);wOE.prototype.Z=function(){var x=[];this.C.descriptionEntity&&x.push(this.C.descriptionEntity);this.C.creators&&x.push.apply(x,g.U(this.C.creators));this.C.theBiggestFan&&x.push(this.C.theBiggestFan);return[].concat(g.U(new Set(x)))};
g.P(KnC,aq);KnC.prototype.Z=function(){return[]};
g.P(XOV,aq);XOV.prototype.Z=function(){return[]};
g.P(x6h,aq);x6h.prototype.Z=function(){return[]};
g.P(Tw9,aq);Tw9.prototype.Z=function(){return[]};
g.P(oLP,aq);oLP.prototype.Z=function(){return[]};
g.P(t3P,aq);t3P.prototype.Z=function(){return[]};
g.P(sCF,aq);sCF.prototype.Z=function(){return[]};
g.P(ui3,aq);ui3.prototype.Z=function(){return[]};
g.P($6F,aq);$6F.prototype.Z=function(){return[]};
g.P(HsF,aq);HsF.prototype.Z=function(){var x=[];this.C.downloadsList&&x.push(this.C.downloadsList);this.C.smartDownloadsList&&x.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&x.push(this.C.recommendedDownloadsList);this.C.refresh&&x.push(this.C.refresh);return[].concat(g.U(new Set(x)))};
g.P(isE,nD);isE.prototype.Z=function(){var x=[];this.C.video&&x.push(this.C.video);this.C.playlist&&x.push(this.C.playlist);this.C.videoItem&&x.push(this.C.videoItem);this.C.playlistItem&&x.push(this.C.playlistItem);return[].concat(g.U(new Set(x)))};
g.P(IrV,aq);IrV.prototype.Z=function(){var x=[];this.C.refresh&&x.push(this.C.refresh);if(this.C.downloads)for(var T=g.S(this.C.downloads),t=T.next();!t.done;t=T.next())x.push.apply(x,g.U((new isE(t.value)).Z()));return[].concat(g.U(new Set(x)))};
g.P(ELF,aq);ELF.prototype.Z=function(){var x=[];this.C.localImageEntities&&x.push.apply(x,g.U(this.C.localImageEntities));return[].concat(g.U(new Set(x)))};
g.P(qpP,aq);qpP.prototype.Z=function(){var x=[];this.C.playbackData&&x.push(this.C.playbackData);this.C.localImageEntities&&x.push.apply(x,g.U(this.C.localImageEntities));this.C.videoDownloadContextEntity&&x.push(this.C.videoDownloadContextEntity);return[].concat(g.U(new Set(x)))};
g.P(Zsy,aq);Zsy.prototype.Z=function(){return[]};
g.P(jCF,aq);jCF.prototype.Z=function(){var x=[];this.C.fakeChildren&&x.push.apply(x,g.U(this.C.fakeChildren));return[].concat(g.U(new Set(x)))};
g.P(ezh,aq);ezh.prototype.Z=function(){var x=[];this.C.video&&x.push(this.C.video);this.C.playbackData&&x.push(this.C.playbackData);this.C.offlineVideoPolicy&&x.push(this.C.offlineVideoPolicy);return[].concat(g.U(new Set(x)))};
g.P(lr9,aq);lr9.prototype.Z=function(){return[]};
g.P(m6h,aq);m6h.prototype.Z=function(){var x=[];this.C.channelOwner&&x.push(this.C.channelOwner);this.C.videos&&x.push.apply(x,g.U(this.C.videos));this.C.collaboratorChannels&&x.push.apply(x,g.U(this.C.collaboratorChannels));this.C.downloadState&&x.push(this.C.downloadState);this.C.refresh&&x.push(this.C.refresh);return[].concat(g.U(new Set(x)))};
g.P(d6y,aq);d6y.prototype.Z=function(){var x=[];this.C.video&&x.push(this.C.video);this.C.channelContributor&&x.push(this.C.channelContributor);return[].concat(g.U(new Set(x)))};
g.P(M3b,nD);M3b.prototype.Z=function(){var x=[];this.C.localImageEntities&&x.push.apply(x,g.U(this.C.localImageEntities));this.C.videoDownloadContextEntity&&x.push(this.C.videoDownloadContextEntity);return[].concat(g.U(new Set(x)))};
g.P(AKy,nD);AKy.prototype.Z=function(){var x=[];this.C.recommendedVideoMetadata&&x.push.apply(x,g.U((new M3b(this.C.recommendedVideoMetadata)).Z()));return[].concat(g.U(new Set(x)))};
g.P(Rzh,nD);Rzh.prototype.Z=function(){var x=[];this.C.playbackPosition&&x.push(this.C.playbackPosition);return[].concat(g.U(new Set(x)))};
g.P(P6d,aq);P6d.prototype.Z=function(){var x=[];this.C.owner&&x.push(this.C.owner);this.C.downloadState&&x.push(this.C.downloadState);this.C.userState&&x.push.apply(x,g.U((new Rzh(this.C.userState)).Z()));this.C.additionalMetadata&&x.push.apply(x,g.U((new AKy(this.C.additionalMetadata)).Z()));return[].concat(g.U(new Set(x)))};
g.P(Sp3,aq);Sp3.prototype.Z=function(){var x=[];this.C.userChannelDetails&&x.push(this.C.userChannelDetails);return[].concat(g.U(new Set(x)))};
g.P(cKb,aq);cKb.prototype.Z=function(){var x=[];this.C.channelOwner&&x.push(this.C.channelOwner);this.C.playbackPosition&&x.push(this.C.playbackPosition);this.C.localImageEntities&&x.push.apply(x,g.U(this.C.localImageEntities));this.C.downloadStatus&&x.push(this.C.downloadStatus);return[].concat(g.U(new Set(x)))};
g.P(Yph,aq);Yph.prototype.Z=function(){return[]};
g.P(U6P,aq);U6P.prototype.Z=function(){return[]};
g.P(bsC,aq);bsC.prototype.Z=function(){return[]};
g.P(rKy,aq);rKy.prototype.Z=function(){return[]};
g.P(zzM,aq);zzM.prototype.Z=function(){return[]};
g.P(k2h,aq);k2h.prototype.Z=function(){return[]};
g.P(Flb,aq);Flb.prototype.Z=function(){return[]};
g.P(hz3,aq);hz3.prototype.Z=function(){return[]};
g.P(vLd,aq);vLd.prototype.Z=function(){return[]};
g.P(V33,aq);V33.prototype.Z=function(){return[]};
g.P(G2d,aq);G2d.prototype.Z=function(){return[]};
g.P(Ll9,aq);Ll9.prototype.Z=function(){var x=[];this.C.trackDownloadMetadatas&&x.push.apply(x,g.U(this.C.trackDownloadMetadatas));return[].concat(g.U(new Set(x)))};
g.P(nLM,aq);
nLM.prototype.Z=function(){var x=[];this.C.downloadedTracks&&x.push.apply(x,g.U(this.C.downloadedTracks));this.C.smartDownloadedTracks&&x.push.apply(x,g.U(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&x.push.apply(x,g.U(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&x.push.apply(x,g.U(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&x.push.apply(x,g.U(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&x.push.apply(x,g.U(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
x.push.apply(x,g.U(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&x.push.apply(x,g.U(this.C.metadataOnlyTracks));return[].concat(g.U(new Set(x)))};
g.P(arb,aq);arb.prototype.Z=function(){var x=[];this.C.trackDownloadMetadatas&&x.push.apply(x,g.U(this.C.trackDownloadMetadatas));return[].concat(g.U(new Set(x)))};
g.P(gLE,aq);gLE.prototype.Z=function(){var x=[];this.C.playbackData&&x.push(this.C.playbackData);this.C.localImageEntities&&x.push.apply(x,g.U(this.C.localImageEntities));this.C.videoDownloadContextEntity&&x.push(this.C.videoDownloadContextEntity);return[].concat(g.U(new Set(x)))};
g.P(BwP,aq);BwP.prototype.Z=function(){var x=[];this.C.musicLibraryStatusEntity&&x.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&x.push.apply(x,g.U(this.C.primaryArtists));this.C.details&&x.push(this.C.details);this.C.userDetails&&x.push(this.C.userDetails);this.C.tracks&&x.push.apply(x,g.U(this.C.tracks));this.C.share&&x.push(this.C.share);this.C.downloadMetadata&&x.push(this.C.downloadMetadata);this.C.refresh&&x.push(this.C.refresh);return[].concat(g.U(new Set(x)))};
g.P(WlC,aq);WlC.prototype.Z=function(){var x=[];this.C.albumRelease&&x.push(this.C.albumRelease);this.C.tracks&&x.push.apply(x,g.U(this.C.tracks));return[].concat(g.U(new Set(x)))};
g.P(D6b,aq);D6b.prototype.Z=function(){var x=[];this.C.albumRelease&&x.push(this.C.albumRelease);return[].concat(g.U(new Set(x)))};
g.P(yKP,aq);yKP.prototype.Z=function(){var x=[];this.C.details&&x.push(this.C.details);this.C.userDetails&&x.push(this.C.userDetails);return[].concat(g.U(new Set(x)))};
g.P(Nw3,aq);Nw3.prototype.Z=function(){var x=[];this.C.parentArtist&&x.push(this.C.parentArtist);return[].concat(g.U(new Set(x)))};
g.P(JK3,aq);JK3.prototype.Z=function(){var x=[];this.C.parentArtist&&x.push(this.C.parentArtist);return[].concat(g.U(new Set(x)))};
g.P(C60,aq);C60.prototype.Z=function(){return[]};
g.P(QC9,aq);QC9.prototype.Z=function(){return[]};
g.P(pL3,nD);pL3.prototype.Z=function(){var x=[];this.C.creatorEntity&&x.push(this.C.creatorEntity);return[].concat(g.U(new Set(x)))};
g.P(OsM,aq);
OsM.prototype.Z=function(){var x=[];this.C.tracks&&x.push.apply(x,g.U(this.C.tracks));this.C.refresh&&x.push(this.C.refresh);this.C.musicLibraryStatusEntity&&x.push(this.C.musicLibraryStatusEntity);this.C.details&&x.push(this.C.details);this.C.downloadMetadata&&x.push(this.C.downloadMetadata);this.C.sideloadMetadata&&x.push(this.C.sideloadMetadata);this.C.userDetails&&x.push(this.C.userDetails);this.C.entryCollection&&x.push(this.C.entryCollection);this.C.share&&x.push(this.C.share);this.C.podcastShowAdditionalMetadata&&x.push.apply(x,
g.U((new pL3(this.C.podcastShowAdditionalMetadata)).Z()));return[].concat(g.U(new Set(x)))};
g.P(frP,aq);frP.prototype.Z=function(){return[]};
g.P(wL0,aq);
wL0.prototype.Z=function(){var x=[];this.C.musicLibraryStatusEntity&&x.push(this.C.musicLibraryStatusEntity);this.C.artists&&x.push.apply(x,g.U(this.C.artists));this.C.audioModeVersion&&x.push(this.C.audioModeVersion);this.C.videoModeVersion&&x.push(this.C.videoModeVersion);this.C.userDetails&&x.push(this.C.userDetails);this.C.details&&x.push(this.C.details);this.C.albumRelease&&x.push(this.C.albumRelease);this.C.share&&x.push(this.C.share);this.C.libraryEdit&&x.push(this.C.libraryEdit);this.C.downloadMetadata&&
x.push(this.C.downloadMetadata);this.C.playbackPosition&&x.push(this.C.playbackPosition);this.C.lyrics&&x.push(this.C.lyrics);return[].concat(g.U(new Set(x)))};
g.P(KlM,aq);KlM.prototype.Z=function(){var x=[];this.C.parentTrack&&x.push(this.C.parentTrack);return[].concat(g.U(new Set(x)))};
g.P(XLd,aq);XLd.prototype.Z=function(){var x=[];this.C.parentTrack&&x.push(this.C.parentTrack);return[].concat(g.U(new Set(x)))};
g.P(xj3,aq);xj3.prototype.Z=function(){return[]};
g.P(T7V,aq);T7V.prototype.Z=function(){return[]};
g.P(oaC,aq);oaC.prototype.Z=function(){return[]};
g.P(tCF,aq);tCF.prototype.Z=function(){return[]};
g.P(sFb,aq);sFb.prototype.Z=function(){var x=[];this.C.transfer&&x.push(this.C.transfer);this.C.adsPlaybackData&&x.push.apply(x,g.U(this.C.adsPlaybackData));this.C.drmLicense&&x.push(this.C.drmLicense);this.C.offlineVideoPolicy&&x.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&x.push(this.C.videoDownloadContextEntity);return[].concat(g.U(new Set(x)))};
g.P(ur3,aq);ur3.prototype.Z=function(){return[]};
g.P($jE,aq);$jE.prototype.Z=function(){var x=[];this.C.offlineVideoStreams&&x.push.apply(x,g.U(this.C.offlineVideoStreams));this.C.captionTrack&&x.push.apply(x,g.U(this.C.captionTrack));return[].concat(g.U(new Set(x)))};
g.P(H$F,aq);H$F.prototype.Z=function(){return[]};
g.P(i$d,aq);i$d.prototype.Z=function(){return[]};
g.P(IjM,aq);IjM.prototype.Z=function(){return[]};
g.P(EaC,aq);EaC.prototype.Z=function(){return[]};
g.P(qLh,aq);qLh.prototype.Z=function(){return[]};
g.P(Z$M,aq);Z$M.prototype.Z=function(){return[]};
g.P(jFb,aq);jFb.prototype.Z=function(){return[]};
g.P(es3,aq);es3.prototype.Z=function(){return[]};
g.P(ljF,aq);ljF.prototype.Z=function(){return[]};
g.P(mjC,aq);mjC.prototype.Z=function(){return[]};
g.P(djy,aq);djy.prototype.Z=function(){return[]};
g.P(MCV,aq);MCV.prototype.Z=function(){return[]};
g.P(A80,aq);A80.prototype.Z=function(){return[]};
g.P(Rsb,aq);Rsb.prototype.Z=function(){return[]};
g.P(POC,aq);POC.prototype.Z=function(){return[]};
g.P(SL3,aq);SL3.prototype.Z=function(){return[]};
g.P(c8d,aq);c8d.prototype.Z=function(){return[]};
g.P(YL3,aq);YL3.prototype.Z=function(){return[]};
var PIP=["browse","music/browse","unplugged/browse"],b5C=["offline/playlist_sync_check"],Z5P=["offline"],SSF=["offline/offline_video_playback_position_sync"],YSV=["offline/get_playback_data_entity"],g1;B2.getInstance=function(){return g.G(function(x){return x.return(new Promise(function(T){g.wm().then(function(t){t?(B2.instance||(B2.instance=new B2(t)),T(B2.instance)):T(void 0)})}))})};
B2.prototype.get=function(x){var T=this,t,u,H;return g.G(function(I){if(I.C==1)return g.v(I,zsd(T.token),2);if(I.C!=3)return t=I.Z,g.v(I,t.get("prefs",x),3);u=I.Z;if(!u)return I.return();H=(0,g.bo)();return u.expirationTimestampMs<=H?I.return():I.return(u.value)})};
B2.prototype.set=function(x,T,t){t=t===void 0?31536E3:t;var u=this,H,I,E;return g.G(function(Z){if(Z.C==1)return H=(0,g.bo)(),I={key:x,value:T,expirationTimestampMs:H+t*1E3},g.v(Z,zsd(u.token),2);E=Z.Z;return g.v(Z,g.vy(E,"prefs",I),0)})};
B2.prototype.remove=function(x){var T=this,t;return g.G(function(u){if(u.C==1)return g.v(u,zsd(T.token),2);t=u.Z;return g.v(u,t.delete("prefs",x),0)})};
g.P(W2,g.CS);g.P(Da,VC9);Da.prototype.j=function(x,T){T=L0M(T);x=(new TextEncoder).encode(JSON.stringify(x));return this.C.encrypt(x,T)};
Da.prototype.Z=function(x,T){if(!(x instanceof Uint8Array))throw kub(1);var t=new TextDecoder;T=L0M(T);x=this.C.decrypt(x,T);return JSON.parse(t.decode(x))};
var na3={accountLinkStatusEntity:x6h,booleanEntity:J5V,buttonEntity:djy,captionTrack:xj3,channelHandle:y5C,commerceAcquisitionClientPayloadEntity:A80,commerceCartListEntity:Rsb,contextNoteFeedEntityPayload:NaV,continuationTokenEntity:lr9,downloadQualityPickerEntity:sCF,downloadsPageRefreshTokenEntity:$6F,downloadsPageViewConfigurationEntity:Yph,downloadStatusEntity:ui3,dismissState:qLh,sfvAudioItemCurrentlyPlayingEntity:i$d,emojiFountainDataEntity:ljF,emojiCustomizationSetEntity:es3,fakeChannel:QA0,
fakePlaylist:pO9,fakePlaylistEntryCollection:fMd,fakeVideo:wOE,fakeVideoDescription:KnC,featuredProductsEntity:vLd,flowStateEntity:XOV,iconBadgeEntity:POC,interstitialInteractionStateEntity:oLP,likeButtonAnimationEntity:U6P,liveChatPollStateEntity:t3P,liveReactionsDataEntity:mjC,logoEntity:Tw9,macroMarkerEntity:bsC,mainDownloadsLibraryEntity:HsF,mainDownloadsListEntity:IrV,mainPlaylistDownloadStateEntity:ELF,mainPlaylistEntity:m6h,mainPlaylistVideoEntity:d6y,mainVideoDownloadStateEntity:qpP,mainVideoEntity:P6d,
markersEngagementPanelSyncEntity:rKy,markersVisibilityOverrideEntity:zzM,musicAlbumReleaseDetail:WlC,musicAlbumReleaseDownloadMetadataEntity:Ll9,musicAlbumRelease:BwP,musicAlbumReleaseUserDetail:D6b,musicArtistDetail:Nw3,musicArtist:yKP,musicArtistUserDetail:JK3,musicDownloadsLibraryEntity:nLM,musicLibraryEdit:C60,musicLibraryStatusEntity:QC9,musicPlaylist:OsM,musicPlaylistDownloadMetadataEntity:arb,musicShare:frP,musicTrackDetail:KlM,musicTrackDownloadMetadataEntity:gLE,musicTrack:wL0,musicTrackUserDetail:XLd,
offlineOrchestrationActionWrapperEntity:T7V,offlineVideoPolicy:oaC,offlineVideoStreams:tCF,offlineabilityEntity:Zsy,orchestrationWebSamplingEntity:jCF,pageHeaderEntity:Z$M,pdpStateEntity:SL3,pinnedProductEntity:V33,playbackData:sFb,playerStateEntity:k2h,quantityIncrementerEntity:c8d,refresh:ur3,saveToPlaylistListEntity:IjM,settingEntity:EaC,stringEntity:C7b,suggestedFeedbackChipStateEntity:Flb,transfer:$jE,trendingOfferEntity:G2d,videoDownloadContextEntity:H$F,videoOverviewAsyncDataEntity:YL3,videoPlaybackPositionEntity:MCV,
votingEntity:jFb,ytMainChannelEntity:Sp3,youchatPendingResponseEntity:hz3,ytMainDownloadedVideoEntity:ezh,ytMainVideoEntity:cKb};g.P(pD,VC9);pD.prototype.j=function(x){return x};
pD.prototype.Z=function(x){if(x instanceof Uint8Array)throw kub(0);return x};
g.P(OG,g.W);OG.prototype.observe=function(x){var T=this;this.observers.push(x);return function(){var t=T.observers.indexOf(x);t>=0&&T.observers.splice(t,1)}};
OG.prototype.Z=function(x){wD9(this,x.data)};
OG.prototype.oU=function(){this.channel.close()};
var o4d,KUP=new g.bA("elementsCommand");var Yf=new g.bA("entityBatchUpdate");var Bld=new g.bA("downloadStatusEntity");var oP3=new g.bA("mainPlaylistEntityActionMetadata");var fa=new g.bA("mainVideoEntityActionMetadata");var qSh=new g.bA("musicPlaylistEntityActionMetadata");var nP0=new g.bA("musicTrackEntityActionMetadata");var dBF=new g.bA("localImageEntityActionMetadata");var La=new g.bA("playbackDataActionMetadata");var XYF=new g.bA("transferEntityActionMetadata");var aK0=new g.bA("videoPlaybackPositionEntityActionMetadata");var dnd;new g.mn;new g.mn;S9V.prototype.request=function(x,T,t){T=T===void 0?{}:T;return this.locks.request(x,T,function(u){return t(u)})};var tI=g.BX.caches,oB,r2b;TR.prototype.open=function(x){return tI.open(UnF(x))};
TR.prototype.has=function(x){return tI.has(UnF(x))};
TR.prototype.delete=function(x){return tI.delete(UnF(x))};
TR.prototype.match=function(x,T){var t=this,u,H,I,E,Z,e;return g.G(function(l){switch(l.C){case 1:return g.v(l,t.keys(),2);case 2:u=l.Z,H=g.S(u),I=H.next();case 3:if(I.done){l.lG(5);break}E=I.value;return g.v(l,t.open(E),6);case 6:return Z=l.Z,g.v(l,Z.match(x,T),7);case 7:if(e=l.Z)return l.return(e);I=H.next();l.lG(3);break;case 5:return l.return()}})};
g.P(Y9d,TR);Y9d.prototype.keys=function(){var x,T,t,u,H,I,E,Z,e;return g.G(function(l){if(l.C==1)return x=[],T=g.QT("CacheStorage keys"),g.v(l,tI.keys(),2);t=l.Z;u=g.S(t);for(H=u.next();!H.done;H=u.next()){I=H.value;var m=I.indexOf(":");E=m===-1?{yN:I}:{yN:I.substring(0,m),datasyncId:I.substring(m+1)};Z=E.yN;e=E.datasyncId;e===T&&x.push(Z)}return l.return(x)})};g.P(up,g.W);up.prototype.j=function(x){this.api.XW("onOfflineOperationFailure",x.data)};
up.prototype.K=function(x){this.api.publish("offlinetransferpause",x.data)};
up.prototype.oU=function(){var x;(x=this.C)==null||x.close();var T;(T=this.Z)==null||T.close()};FU3.prototype.oH=function(){this.C&&HS(this)};
FU3.prototype.WC=function(){this.Z&&this.Z.resolve();this.j=this.C=!1;this.S()};var lud=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var OEy="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var $z9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.P(zI9,vS);zI9.prototype.Z=function(x){return qh(x)?hIb(this,x):Zb(x)?Gs0(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.P(LL9,vS);LL9.prototype.Z=function(x){return Zb(x)?nJM(this,x):g43(x)?gJd(this,x):j_(x)?BTC(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.q=WLy.prototype;g.q.lkc=function(x){var T=this,t,u,H,I;return g.G(function(E){if(!g.p(x.state,128))return E.lG(0);t=x.state.Eo;var Z=(u=t)==null?void 0:u.errorCode,e=(H=t)==null?void 0:H.Ik;I=Z==="net.connect"&&e===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(Z==null?0:Z.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.v(E,T.Is(T.player.getVideoData().videoId,I),0)})};
g.q.Is=function(x,T){var t=this;return g.G(function(u){if(u.C==1){if(t.Z)return u.return();t.Z=!0;return T==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(gA(t,x,!1,!0),u.lG(0)):g.v(u,aB(t,x),3)}g.F4(x,4);return g.v(u,t.C.Is(T),0)})};
g.q.jr=function(x){x.status===2?(x.status!==this.j&&(nwy(this.C),g.F4(x.videoId,2)),x.Fb&&DV9(this.C,x.videoId,x.Fb)):x.status===4?(aB(this,x.videoId),this.Is(x.videoId,x.qx?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):x.status===1&&Wfd(this.C);this.j=x.status;this.api.XW("localmediachange",{videoId:x.videoId,status:x.status})};
g.q.AL=function(){var x=this,T;return g.G(function(t){if(t.C==1){if(x.Z)return t.return();x.Z=!0;T=x.player.getVideoData().videoId;return g.v(t,aB(x,T),2)}return g.v(t,x.C.AL(),0)})};
g.q.Cr=function(x){switch(x){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.q.B=function(x){return this.api.Y().B(x)};g.P(pYE,vS);pYE.prototype.Z=function(x){return qh(x)?fK9(this,x):Zb(x)?wYE(this,x):g43(x)?KLE(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};sp0.prototype.C=function(x,T){var t=x.action.actionMetadata.priority-T.action.actionMetadata.priority;t===0&&(x.C<T.C?t=-1:x.C>T.C&&(t=1));return t};g.P(BS,g.W);BS.prototype.oU=function(){this.S&&this.S();g.W.prototype.oU.call(this)};
BS.prototype.createAction=function(x,T){var t=g.u1(x.entityKey).entityType,u=g.Sq(16);return new Mh(t,u,x,T.actionId,T.rootActionId)};
BS.prototype.jY=function(x){var T=this,t,u,H,I,E,Z,e,l,m;return g.G(function(d){if(d.C==1){if(T.T9())return d.return();u=(t=x.offlineOrchestrationActionWrapperEntity)!=null?t:new Set;H=[];I=g.S(u);for(E=I.next();!E.done;E=I.next())Z=E.value,e=g.u1(Z),l=e.entityId,Ht0(T.C,l)||H.push(Z);return g.v(d,MEh(T,H),2)}m=d.Z;return g.v(d,dVd(T,m),0)})};
BS.prototype.retry=function(){var x=this;return g.G(function(T){return g.v(T,A_y(x),0)})};PN0.prototype.wV=function(x,T){T=T===void 0?!0:T;var t=this,u,H,I,E,Z,e,l,m;return g.G(function(d){switch(d.C){case 1:if(!t.C)return d.return();u=[];H=g.l8(t.C.Z,T);I=[];for(E={b8:0};E.b8<H.length;E={b8:E.b8},E.b8++)Z=H[E.b8],e=t.C.xf(Z,"json3"),l=g.kD(e,{withCredentials:!0,format:"RAW"},3,500).then(function(M){return function(A){A={metadata:g.lq(H[M.b8]),trackData:A.xhr.responseText};I.push(A)}}(E)).p_(function(M){sj("Caption fetch error",M)}),u.push(l);
return g.v(d,DqP(u),2);case 2:return g.PX(d,3),g.v(d,E4V(x,I),5);case 5:g.cX(d,0);break;case 3:m=g.Yq(d),sj("Caption DB transaction error",m),g.RV(d)}})};g.P(WS,g.W);WS.prototype.oU=function(){this.Z&&this.Z();g.W.prototype.oU.call(this)};
WS.prototype.j=function(x){var T=this,t,u,H,I,E,Z,e,l;return g.G(function(m){u=(t=x.transfer)!=null?t:new Set;H=[];I=g.S(u);for(E=I.next();!E.done;E=I.next())Z=E.value,e=g.u1(Z),l=e.entityId,H.push(l);return H.length===0?m.return():g.v(m,YXb(T,H),0)})};g.P(kny,g.W);g.q=kny.prototype;g.q.oU=function(){this.uG&&this.uG();this.Hv.dispose();this.K.dispose();this.QU&&g.a0(this.D.TM,this.QU);this.hQ&&g.a0(this.D.TM,this.hQ);g.W.prototype.oU.call(this)};
g.q.nxj=function(x){var T=this,t,u,H;return g.G(function(I){switch(I.C){case 1:t=g.$Q(x,"transfer");if(T.C&&t===T.C.key){gA(T.N,T.T,!0);T.K.stop();I.lG(0);break}return g.v(I,fD(T.Z,{mode:"readwrite",c9:!0},function(E){return yH(E,t,"transfer").then(function(Z){if(Z&&Z.transferState!=="TRANSFER_STATE_COMPLETE"&&Z.transferState!=="TRANSFER_STATE_FAILED")return Z.transferState="TRANSFER_STATE_PAUSED_BY_USER",CD(E,Z,"transfer").then(function(){return Z})})}),3);
case 3:u=I.Z;if(!u){I.lG(0);break}if(!x||!T.j){I.lG(5);break}return g.v(I,e_(x,T.j,T.Z,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.v(I,Nh(T,x),7);case 7:H=I.Z,n4C({videoId:x,ZN:u,offlineModeType:H}),g.RV(I)}})};
g.q.fxW=function(){var x=this;if(this.C&&this.T){gA(this.N,this.T,!1);var T=this.C,t=(T==null?0:T.key)?g.u1(T.key).entityId:"";t&&this.j&&(new Promise(function(u,H){e_(t,x.j,x.Z,"DOWNLOAD_STATE_PAUSED").catch(function(I){H(I)})})).catch(function(u){sj("Download state setting error",u)})}this.K.stop()};
g.q.Ep=function(){this.C?vwb(this,this.C):yA(this)};
g.q.kY=function(x){var T=this;return g.G(function(t){switch(t.C){case 1:if(!T.C){t.lG(2);break}if(T.C.transferState==="TRANSFER_STATE_COMPLETE"||T.C.transferState==="TRANSFER_STATE_FAILED"||!x.transfer||!x.transfer.has(T.C.key)){t.lG(3);break}return g.v(t,KD(T.Z,T.C.key,"transfer"),4);case 4:T.C=t.Z;if(T.C){t.lG(3);break}return g.v(t,VE9(T),3);case 3:if(T.C)return t.return();case 2:return g.v(t,yA(T),0)}})};
g.q.Is=function(x,T){var t=this,u,H,I,E,Z;return g.G(function(e){switch(e.C){case 1:if(!t.C){JI(t,"onTransferFailure: "+x);e.lG(2);break}u=t.C;I=((H=u)==null?0:H.key)?g.u1(u.key).entityId:"";a:switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var l=!1;break a;default:l=!0}return l&&y_y(t)?g.v(e,Ca(t,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.v(e,
NXF(t,x),5);case 5:if(!I||!t.j){e.lG(2);break}return g.v(e,e_(I,t.j,t.Z,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.v(e,Nh(t,I),9);case 9:E=e.Z;IB({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:I,ZN:u,offlineModeType:E});if(!I||!t.j){e.lG(2);break}return g.v(e,e_(I,t.j,t.Z,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Db(t),Z=yA(t,!0),T&&T(Z),g.RV(e)}})};
g.q.AL=function(x){var T=this,t,u,H,I,E,Z,e,l,m,d,M,A;return g.G(function(R){switch(R.C){case 1:if(!T.C){JI(T,"onMaybeTransferStreamsExpired");R.lG(2);break}return y_y(T)?g.v(R,Ca(T,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.v(R,NXF(T,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!T.j){R.lG(2);break}t=T.C;H=((u=t)==null?0:u.key)?g.u1(t.key).entityId:"";if(!H){R.lG(2);break}return g.v(R,e_(H,T.j,T.Z,"DOWNLOAD_STATE_FAILED"),2);case 9:return T.C||JI(T,"onMaybeTransferStreamsExpiredRetryAttempting"),
I=T.C,Z=((E=I)==null?0:E.key)?g.u1(I.key).entityId:"",g.v(R,Nh(T,Z),10);case 10:return e=R.Z,IB({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:Z,ZN:I,offlineModeType:e}),l=y2V(),g.gp(l,La,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m=g.$Q(Z,"playbackData"),d={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:m,actionMetadata:l},M=RB(new Mh("playbackData",Z,d)),g.v(R,w1(T.Z,M,"offlineOrchestrationActionWrapperEntity"),2);case 2:Db(T),A=yA(T,!0),
x&&x(A),g.RV(R)}})};
var p$0={},J_9=(p$0.TRANSFER_STATE_TRANSFERRING=1,p$0.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,p$0);g.q=QA.prototype;g.q.P6=function(){return this.T.promise};
g.q.Jz=function(){if(this.Z&&this.N)return this.T.promise;psy(this).then(this.T.resolve).catch(this.T.reject);return this.T.promise};
g.q.YW=function(x){var T={};return T.playbackData=new zI9(x,this.Cf,this.C),T.transfer=new pYE(x,this.Cf),T.videoPlaybackPositionEntity=new LL9(x,this.Cf),T};
g.q.kI=function(){var x=this;return g.G(function(T){return x.Z?g.v(T,FfP(x.Z),0):T.lG(0)})};
g.q.Wq=function(){var x=this,T,t;return g.G(function(u){if(u.C==1)return x.Z||x.N?g.v(u,x.P6(),2):u.return();x.J!==void 0&&(g.M2(x.J),x.J=void 0);x.K!==void 0&&(g.M2(x.K),x.K=void 0);(T=x.Z)==null||T.dispose();x.Z=void 0;(t=x.N)==null||t.dispose();x.N=void 0;x.api.XW("onOrchestrationLostLeader");x.T=new g.mn;g.RV(u)})};
g.q.isOrchestrationLeader=function(){return this.j.C};
g.q.Wu=function(){return g.G(function(x){return x.return(!1)})};
g.q.yG=function(x){var T=this.C;T.api.publish("offlinetransferpause",x);var t;(t=T.Z)==null||t.postMessage(x)};
g.q.Ep=function(x){var T,t;return g.G(function(u){if(u.C==1)return g.v(u,xf(),2);T=u.Z;if(!T)return u.return();t=g.$Q(x,"transfer");return g.v(u,fD(T,{mode:"readwrite",c9:!0},function(H){var I=yH(H,t,"transfer"),E=yH(H,g.$Q(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.SD.all([I,E]).then(function(Z){Z=g.S(Z);var e=Z.next().value;var l=Z.next().value;return e&&e.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(e.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",CD(H,e,"transfer").then(function(){IB({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:x,ZN:e,offlineModeType:l==null?void 0:l.offlineModeType});return g.SD.resolve(null)})):g.SD.resolve(null)})}),0)})};
g.q.AX=function(x){x=x===void 0?43200:x;var T=this,t,u,H,I,E,Z,e,l;return g.G(function(m){if(m.C==1)return T.D.TV()?g.v(m,xf(),2):m.return(Ot9());if(m.C!=3){t=m.Z;if(!t)return m.return([]);u=Date.now()/1E3;return g.v(m,Xg(t,"offlineVideoPolicy"),3)}H=m.Z;I=[];E=g.S(H);for(Z=E.next();!Z.done;Z=E.next())e=Z.value,Number(e.lastUpdatedTimestampSeconds)+x<=u&&(l=g.u1(e.key).entityId,I.push(l));return I.length?m.return(pa(T,I,T.S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):m.return([])})};
g.q.deleteAll=function(){return pa(this,["!*$_ALL_ENTITIES_!*$"],this.S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.q.refreshAllStaleEntities=function(x){var T=this;return g.G(function(t){return t.C==1?g.v(t,T.AX(x),2):t.return(t.Z)})};
g.q.setUpPositionSyncInterval=function(x){var T=this;this.K!==void 0&&(g.M2(this.K),this.K=void 0);var t=x!=null?x:864E5;this.K=g.mF(function(){T.Fj(t)},t)};
g.q.Fj=function(x){var T=this,t,u,H,I,E,Z;return g.G(function(e){switch(e.C){case 1:return g.PX(e,2),g.v(e,B2.getInstance(),4);case 4:t=e.Z;if(!t)throw Error("prefStorage is undefined");return g.v(e,t.get("psi"),5);case 5:u=e.Z;I=((H=u)==null?0:H.c6)?Number(u.c6)/1E3:0;E=Date.now();if(!(I+x<=E)){e.lG(6);break}return g.v(e,pa(T,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.cX(e,0);break;case 2:Z=g.Yq(e),sj("Offline manager error",Z),
g.RV(e)}})};
g.q.bd=function(){var x=this,T,t,u,H,I,E,Z;return g.G(function(e){if(e.C==1)return g.v(e,xf(),2);if(e.C!=3)return(T=e.Z)?g.v(e,Xg(T,"transfer"),3):e.return([]);t=e.Z;u=[];H=g.S(t);for(I=H.next();!I.done;I=H.next())E=I.value,E.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&E.key&&(Z=g.u1(E.key).entityId,u.push(Z));return e.return(wsM(x,u))})};
g.q.JF=function(){return g.G(function(x){return x.return([])})};
g.q.tZ=function(){return g.G(function(x){g.RV(x)})};
g.q.oy=function(){return g.G(function(x){g.RV(x)})};g.P(Kfb,vS);Kfb.prototype.Z=function(x){return qh(x)?TYM(this,x):Zb(x)?tWh(this,x):j_(x)?sc3(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var Oj=[10];g.P(IoV,vS);IoV.prototype.Z=function(x){return qh(x)?Zeh(this,x):Zb(x)?jcM(this,x):j_(x)?eLF(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var qRy=[10];g.P(mBV,vS);mBV.prototype.Z=function(x){return Zb(x)?MWh(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.P(Aw0,QA);g.q=Aw0.prototype;g.q.YW=function(x){var T=QA.prototype.YW.call(this,x);T.mainVideoEntity=new IoV(x,this.Cf,this.C);T.mainPlaylistEntity=new Kfb(x,this.Cf,this.C);T.mainDownloadsListEntity=new mBV(x,this.Cf,this.C);return T};
g.q.refreshAllStaleEntities=function(x,T){var t=this,u,H,I,E,Z,e,l,m,d,M,A;return g.G(function(R){switch(R.C){case 1:u=[];if(!t.Cf.B("web_player_offline_playlist_auto_refresh")){R.lG(2);break}return g.v(R,RLC(t,x,T),3);case 3:u=R.Z;case 2:return g.v(R,B2.getInstance(),4);case 4:return H=R.Z,g.v(R,(I=H)==null?void 0:I.get("sdois"),5);case 5:return E=R.Z,g.v(R,(Z=H)==null?void 0:Z.get("lmqf"),6);case 6:e=R.Z;if(!E){R.lG(7);break}m=u;d=m.concat;return g.v(R,PY0(t,E,(l=e)!=null?l:"SD",x===0),8);case 8:u=
d.call(m,R.Z);case 7:return M=u,A=M.concat,g.v(R,QA.prototype.refreshAllStaleEntities.call(t,x,T),9);case 9:return u=A.call(M,R.Z),R.return(u)}})};
g.q.Wu=function(x){var T,t,u,H,I,E,Z,e;return g.G(function(l){if(l.C==1)return g.v(l,xf(),2);if(l.C!=3)return(T=l.Z)?g.v(l,KD(T,g.Lp,"mainDownloadsListEntity"),3):l.return(!1);t=l.Z;if((u=t)==null?0:(H=u.downloads)==null?0:H.length)for(I=g.$Q(x,"mainVideoEntity"),E=g.S(t.downloads),Z=E.next();!Z.done;Z=E.next())if(e=Z.value,e.videoItem===I)return l.return(!0);return l.return(!1)})};
g.q.JF=function(){var x=this,T,t,u,H,I,E,Z,e;return g.G(function(l){if(l.C==1)return g.v(l,xf(),2);if(l.C!=3)return(T=l.Z)?g.v(l,Xg(T,"downloadStatusEntity"),3):l.return([]);t=l.Z;u=[];H=g.S(t);for(I=H.next();!I.done;I=H.next())E=I.value,E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&E.key&&(Z=g.u1(E.key).entityId,u.push(Z));return u.length?(e={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},l.return(pa(x,u,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
e))):l.return([])})};
g.q.oy=function(){var x;return g.G(function(T){return T.C==1?g.v(T,xf(),2):(x=T.Z)?g.v(T,fD(x,{mode:"readwrite",c9:!0},function(t){return NZ(t,"mainVideoEntity").then(function(u){var H=[];u=g.S(u);for(var I=u.next();!I.done;I=u.next()){I=I.value;var E=void 0;(E=I.userState)!=null&&E.playbackPosition||(E=g.u1(I.key).entityId,E={key:g.$Q(E,"videoPlaybackPositionEntity"),videoId:E,lastPlaybackPositionSeconds:"0"},H.push(CD(t,E,"videoPlaybackPositionEntity")),I.userState={playbackPosition:E.key},H.push(CD(t,
I,"mainVideoEntity")))}return g.SD.all(H)})}),0):T.return()})};
g.q.tZ=function(){var x,T,t,u,H,I,E,Z,e,l,m,d,M,A,R,Y,b,z,F,V,B,D,f,O,sH,HX,xq,J,X,c,C,WX,PE,j0,r5,w5,tM,md;return g.G(function(r){if(r.C==1)return g.v(r,xf(),2);if(r.C!=3){x=r.Z;if(!x)return r.return();T=g.$Q("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.v(r,fD(x,{mode:"readonly",c9:!0},function(k){return g.SD.all([yH(k,T,"mainDownloadsListEntity"),yH(k,g.Lp,"mainDownloadsListEntity"),NZ(k,"mainVideoEntity"),NZ(k,"mainPlaylistEntity")])}),3)}t=r.Z;
u=g.S(t);H=u.next().value;I=u.next().value;E=u.next().value;Z=u.next().value;e=H;l=I;m=E;d=Z;M=new Set;if((A=e)==null?0:(R=A.downloads)==null?0:R.length)for(Y=g.S(e.downloads),b=Y.next();!b.done;b=Y.next())z=b.value,F=void 0,(V=(F=z.videoItem)!=null?F:z.playlistItem)&&M.add(V);if((B=l)==null?0:(D=B.downloads)==null?0:D.length)for(f=g.S(l.downloads),O=f.next();!O.done;O=f.next())sH=O.value,sH.videoItem&&M.add(sH.videoItem);HX=new Set;xq=[];J=g.S(d);for(X=J.next();!X.done;X=J.next()){c=X.value;if(c.videos)for(C=
g.S(c.videos),WX=C.next();!WX.done;WX=C.next())PE=WX.value,(j0=JSON.parse(g.u1(PE).entityId).videoId)&&HX.add(j0);c.key&&!M.has(c.key)&&xq.push(c.key)}r5=g.S(m);for(w5=r5.next();!w5.done;w5=r5.next())tM=w5.value,tM.key&&!M.has(tM.key)&&(md=g.u1(tM.key).entityId,HX.has(md)||xq.push(tM.key));return xq.length?g.v(r,oJ0(x,xq),0):r.lG(0)})};g.P(SRC,vS);SRC.prototype.Z=function(x){return qh(x)?YRh(this,x):Zb(x)?UBV(this,x):j_(x)?bey(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var wA=[10];g.P(zLE,vS);zLE.prototype.Z=function(x){return qh(x)?F5M(this,x):Zb(x)?hLE(this,x):j_(x)?vP3(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var Ka=[10];g.P(L5d,vS);L5d.prototype.Z=function(x){return qh(x)?BY9(this,x):Zb(x)?W5d(this,x):j_(x)?DB9(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var gPb=[10];g.P(X5,QA);X5.prototype.YW=function(x){var T=QA.prototype.YW.call(this,x);T.musicTrack=new L5d(x,this.C);T.musicPlaylist=new zLE(x,this.C);T.musicAlbumRelease=new SRC(x,this.C);return T};
X5.prototype.refreshAllStaleEntities=function(x,T){var t=this,u,H,I;return g.G(function(E){if(E.C==1)return g.v(E,NY9(t,x,T),2);if(E.C!=3)return H=u=E.Z,I=H.concat,g.v(E,QA.prototype.refreshAllStaleEntities.call(t,x,T),3);u=I.call(H,E.Z);return E.return(u)})};g.P(Jw9,g.r_);g.q=Jw9.prototype;g.q.create=function(){var x=this;g.y(this,this.events);g.f1(this.Cf)?this.C=new Aw0(this.Cf,this.player):g.L2(this.Cf)&&(this.C=new X5(this.Cf,this.player));this.events.V(this.player,"onPlaybackStartExternal",function(){x.rQ()});
this.events.V(this.player,"videodatachange",function(){x.rQ()});
this.Cf.B("html5_offline_playback_position_sync")&&this.events.V(this.player,"presentingplayerstatechange",this.sS)};
g.q.uy=function(){return!1};
g.q.MD=function(x,T,t,u){var H=this;return g.G(function(I){return H.C?I.return(pa(H.C,x,T,t,u)):I.return(Promise.reject())})};
g.q.deleteAll=function(){return this.C.deleteAll()};
g.q.AX=function(x){return this.C.AX(x)};
g.q.refreshAllStaleEntities=function(x){return this.C.refreshAllStaleEntities(x)};
g.q.setUpPositionSyncInterval=function(x){this.C.setUpPositionSyncInterval(x)};
g.q.yG=function(x){this.C.yG(x)};
g.q.Ep=function(x){return this.C.Ep(x)};
g.q.rQ=function(){var x=this,T;return g.G(function(t){T=x.player.getVideoData();return g.Km(T)?CYM(T)&&x.Z!==T.clientPlaybackNonce?g.v(t,QcV(x,T),0):t.lG(0):t.return()})};
g.q.sS=function(x){var T=this,t,u,H,I,E,Z,e;return g.G(function(l){if(l.C==1)return t=T.player.getVideoData(),u=t.AQ,g.j1(x,2)||g.j1(x,512)?g.v(l,xf(),2):l.return();if(l.C!=3){H=l.Z;if(!H)return sj("PES is undefined"),l.return();I=t.videoId;return g.v(l,KD(H,g.$Q(I,"mainVideoEntity"),"mainVideoEntity"),3)}E=l.Z;if(!E)return l.return();Z=Math.floor(u).toString();e={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:Z}};return g.v(l,T.MD([I],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
e),0)})};
g.q.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.q.updateDownloadState=function(x,T){var t,u,H,I;return g.G(function(E){if(E.C==1)return g.v(E,xf(),2);t=E.Z;if(!t)return sj("PES is undefined"),E.return();u=g.u1(x);H=u.entityType;I=u.entityId;return g.v(E,e_(I,H,t,T,!0),0)})};g.b8("offline",Jw9);})(_yt_player);
